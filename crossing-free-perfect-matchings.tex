\documentclass[10pt, a4paper, twoside]{basestyle}

\usepackage{tikz}
\usetikzlibrary{cd}
\usetikzlibrary{calc}
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{intersections}
\usepackage{tikz-qtree}
\usepackage{braids}

\usepackage[Mathematics]{semtex}

%%%% Shorthands.
\newcommand{\idest}{\emph{, i.e.,\ }}

\DeclareMathOperator{\cells}{cells}
\DeclareMathOperator{\spc}{spc}
\DeclareMathOperator{\PM}{PM}
\DeclareMathOperator{\CFPM}{CFPM}
\DeclareMathOperator{\PMAL}{PMAL}
\DeclareMathOperator{\CFPMAL}{CFPMAL}
\DeclareMathOperator{\CFLA}{CFLA}
\DeclareMathOperator{\CFRA}{CFRA}
\DeclareMathOperator{\leftmost}{lm}
\DeclareMathOperator{\LC}{LC}

\newcommand*{\tn}[2]{\tikz[baseline,remember picture]\node[inner sep=0pt,anchor=base] (#1) {#2};}

%%%% Title and authors.

\title{%
\textdisplay{%
Crossing-Free Perfect Matchings%
}%
}
\author{Robin~Leroy}
\begin{document}
\maketitle
\begin{abstract}
[TODO main results: the spc bound, the bound dependent on the number of interior points;
maybe I'll have brief discussion of suggestions for improvements to the Catalan and spc
bounds, in which case mention it here.
Do I mention the expressions for the Catalan triangle (are they known)?]
\end{abstract}

\section*{Introduction}
In the study of plane embeddings of planar graphs, also known as plane graphs,
embeddings with non-crossing straight edges (called crossing-free geometric graphs) are of particular
interest.
For instance, it is known \cite{LeeuwenSchoone1981} that any optimal solution to the travelling salesman problem in the
Euclidean plane has non-crossing straight edges.
In 1936, K.~Wagner proved\footnote{This result was independently proved by I.~Fáry in 1948 [CITE], and by
S.~K.~Stein in 1951 [CITE]; it is generally known as Fáry's theorem.} [CITE] that any planar graph has such an
embedding.

A natural enumerative question is then, given a vertex set of $n$ points in the Euclidean plane,
to bound the number of plane graphs of a certain sort (cycles, matchings, etc.) which can be
drawn with non-crossing straight edges.
For spanning cycles, the question was introduced by M.~Newborn and W.~O.~J.~Moser in 1976 \cite{NewbornMoser1980},
and a super-exponential upper bound was given.
In 1980, M.~Ajtai, V.~Chvátal, M.~Newborn, and E.~Szemerédi \cite{AjtaiChvatalNewbornSzemeredi1982}
proved that there are only exponentially many crossing-free geometric graphs on a given point set.

Exponential bounds for various sorts of graphs were then improved, in particular for triangulations---these are
the maximal crossing-free geometric graphs, so finding a bound for them yields a bound
for the overall number of crossing-free geometric graphs. [TODO citation] In addition, bounds on the number of triangulations
are of interest in geometric modeling [CITE Studies in computational geometry motivated by mesh generation].

Some special configurations of points are better understood; in particular, for point sets in convex position,
the numbers of crossing-free perfect matchings, triangulations, and spanning cycles are known. In fact, the study
of point sets in convex position vastly predates the general problem, with the number of triangulations given by
Euler in 1751 \cite{Euler1751}.

For perfect matchings, an optimal lower bound of $C_{\frac n 2}$ was obtained as early as 1995 by A.~García,
M.~Noy, and J.~Tejel \cite{GarciaNoyTejel2000}; upper bounds have been harder to come by, with the best one
yet being asymptotically $10.05^n$, given by M.~Sharir and E.~Welzl in 2005 \cite{SharirWelzl2006}
In that same work, an upper bound of $5.83^n$ is given for the number of crossing-free perfect matchings on a
point set whose points are designated as left or right endpoints; moreover, an upper bound of $4^n$ is given
when all the left endpoints are to the left of the right endpoints (matchings across a line).

Here we give new bounds on the number of crossing-free perfect matchings on a point set with designated left and
right endpoints for specific left-to-right orderings of the left and right endpoints, and give a bound for
matchings across a line that depends on the number of points in the interior of the convex hull.
\section{Background}
We first give some definitions, as well as existing proofs whose concepts we will use to derive our results.
\subsection{Geometric graphs}
\begin{definition}[geometric graph]
Given a set of points $P$ in the Euclidean plane $\R^2$,
a \emph{geometric graph} is a collection of straight line segments (edges)
whose endpoints are elements of $P$.

It can be described as a simple graph (in the combinatorial sense)
on the vertices $P$, where the edge $\set{v,w}$ corresponds to the segment joining
$v$ and $w$.
\end{definition}
\begin{definition}[crossing-free]
A geometric graph is \emph{crossing-free} if no two edges share points other than
their endpoints; it is called \emph{crossing} otherwise.
\end{definition}
Note that being crossing-free implies that the corresponding simple graph is planar, and that the
geometric graph is a plane embedding.
\begin{sloppypar}
\begin{definition}[triangulation]
A \emph{triangulation} is a maximal crossing-free geometric graph, that is,
geometric graph such that for all $v$ and $w$ in $P$ that are not joined by a
segment, adding the segment joining $v$ and $w$ would result in a crossing
geometric graph.
\end{definition}
Note that the faces (in the sense of plane graphs) formed by a triangulation are
all triangles, with the possible exception of the outer face (thus this definition
is \emph{not} equivalent to that of a triangulation of the $2$-sphere).
\end{sloppypar}

Since a geometric graph corresponds to a simple graph on the underlying point set,
we can also look at geometric graphs that belong to special classes of simple graphs.
As we will only be focusing on geometric graphs, we simply call
\emph{perfect matching}
a geometric graph which corresponds to a perfect matching in the combinatorial sense.

As outlined in the introduction, we are interested in statements regarding the number
of geometric graphs, possibly restricted to a certain type, on a given point set.
Evidently, that number would depend on the choice of the point set $P$, so instead we seek
bounds on that number depending on the cardinality $\Cardinality P$, and possibly
restricting $P$ so that it satisfies certain properties.

An important property that $P$ can have is general position. We say that 
a point set in the plane is \emph{in general position} if no three points are collinear.
Here we will only study point sets in general position.

In general, if $g\of P$ is the number of geometric graphs of a certain sort on the point
set $P$, we will look for lower bounds $l$ and upper bounds $u$ of the form\[
\forall n\in \N, \forall P \text{ such that } \Cardinality P = n,
l \of n \leq g \of n \leq u \of n \text,\]
where $P$ runs over all point sets that satisfy the relevant properties.

In addition, we will want asymptotics on such bounds $l$ and $u$, to compare them with
existing results; since the bounds are often exponential, we tend to ignore polynomial
factors; we will thus write that\[
f \of n \preccurlyeq u \of n
\]
if $f\of n \leq p\of n u \of n$ for some polynomially-bounded $p$.
\subsection{Triangulations of convex point sets and the Catalan numbers}
A set of points is said to be \emph{in convex position} if it is in general position and
all points are in the boundary of its convex hull.

For points in convex position, the numbers of triangulations and perfect matchings are known.
The following recurrence, given by J.~A.~Segner in 1758 \cite{Segner1758}, defines the \emph{Catalan numbers}.
\begin{theorem}[Segner]
Let $C_n$ be the number of triangulations of a set of $n+2$ points in convex position.
Then $C_0 = 1$, and for $n>0$, \begin{equation}
C_n = \sum {i=0}[n-1] C_i C_{n-i-1}\text. \label{CatalanRecurrence}
\end{equation}
\begin{proof}
Consider a set of $n+2$ points in convex position.
For $n=0$ the result is trivial, the only triangulation is an edge.

Let $n > 0$, and number the points in polar order (around the interior of the convex hull), from $0$ to $n+1$.
The edge $e$ joining points $n+1$ and $\pa{n}$ is in the boundary of the convex hull, and thus must
be in any triangulation, since no other edge can cross it. Let $i$ be the index of the third point of the
triangle containing edge $e$, which may be any of the others, from $0$ to $n-1$.

Then, removing restricting the triangulation to the $i+2$ points $\set{0,\dotsc,i,n+1}$ yields a triangulation
of those points.
Similarly, restricting the triangulation of the whole point set to points $i$ through $n$ yields a triangulation of
$n-i+1$ points. It follows that $C_n \leq \sum {i=0}[n-1] C_i C_{n-i-1}$.

Moreover, given a triangulation of $\set{0,\dotsc,i,n+1}$ and a triangulation of $\set{i,\dotsc, n}$,
adding the edge $e$ forms a triangulation of the whole point set, proving equality.
\end{proof}
\end{theorem}
An explicit expression for $C_n$ was given earlier by Euler \cite{Euler1751}, along
with the generating function.
A convenient form is\begin{equation}
C_n = \frac{1}{n+1} \binom {2n} {n}\text,
\end{equation}
yielding asymptotically
\begin{equation}
C_n \preccurlyeq 4^n\text.
\end{equation}

\subsection{Crossing-free perfect matchings}
\label{PerfectMatchingsIntro}
We will call $\PM_P$ the set of perfect matchings on the point set $P$, and $\CFPM_P$ the set
of crossing-free perfect matchings on the point set $P$.

[TODO talk about the number of crossing-free perfect matchings in convex position, give the proof;
find the Alfred Errera thing from the octavo of the académie royale de belgique, reference 10 in
Sharir--Welzl; this might require a trip to the library?]

For a set $P$ of $n$ points in general position, it was proved by Micha~Sharir and Emo~Welzl in 2005
\cite{SharirWelzl2006} that $\Cardinality{\CFPM_P} \preccurlyeq 10.05^n$.

When talking about a perfect matching, we will denote the unique edge incident to point $p$ by
$e_p$.

\subsection{Bracket expressions and their relations to perfect matchings}

We say that a point set is \emph{in general position with respect to the horizontal} if it
is in general position and no two points lie on a vertical line. Note that any point set in
general position can be put in general position with respect to the horizontal by an arbitrarily
small rotation. Moreover, note that points in general position with respect to the horizontal
are ordered from left to right.

This ordering can be used to classify perfect matchings on the point set; to this end,
we introduce bracket expressions.
A \emph{bracket expression} of length $n$ is a sequence of $n$ opening brackets $\langle$ or closing
brackets $\rangle$.
It is a \emph{well-formed prefix} if, when read from left to right, the number of closing brackets
encountered never exceeds the number of opening brackets encountered.
A \emph{well-formed bracket expression} is a well-formed prefix with the same number of opening and
closing brackets.

It is a well-known result, shown\footnote{Specifically, Catalan showed that the recurrence (\ref{CatalanRecurrence})
counts the number of parenthesizings of $n+1$ factors.} by E.~C.~Catalan in 1838 \cite{Catalan1838}, that the
number of well-formed bracket expressions
of length $2k$ is the Catalan number $C_k$. In fact, the recurrence can readily be seen from
a grammatical definition of well-formed bracket expressions,\footnote{We have not enclosed nonterminals
in angle brackets here, as would be usual in Backus--Naur form, since that would result in hopeless
confusion in a grammar describing nothing but sequences of angle brackets.}\begin{align*}
\text{wfbe} \Coloneq
& \langle \text{wfbe} \rangle \text{wfbe} \\
\mid\: & \text{empty}\text,
\end{align*}
where the sum ranges over the lengths of the component bracket expressions.

Note that inserting an opening bracket, followed by a closing bracket anywhere after the
inserted opening bracket, into a well-formed bracket expression, results in a well-formed bracket
expression.

Well-formed bracket expressions can be used to define classes of perfect matchings on a given point set.
Given a point set $P$  of size $n$ in general position with respect to the horizontal and a perfect
matching $\gm$ on $P$, any point in $P$ is either a left or right endpoint of an edge, since it
is incident to exactly one edge, and that edge is not vertical.

\marginfig[A well-formed bracket expression constructed from a perfect matching.]{
\begin{tikzpicture}[scale=0.5]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\node[dot] at (0,2) (p1) {};
\node[dot] at (1,3) (p2) {};
\node[dot] at (2,4) (p3) {};
\node[dot] at (3,0) (p4) {};
\node[dot] at (5,1) (p5) {};
\node[dot] at (6,3) (p6) {};

\node at (0,-1) (b1) {$\langle$};
\node at (1,-1) (b2) {$\langle$};
\node at (2,-1) (b3) {$\rangle$};
\node at (3,-1) (b4) {$\langle$};
\node at (5,-1) (b5) {$\rangle$};
\node at (6,-1) (b6) {$\rangle$};

\draw (p1) -- (p5);
\draw (p2) -- (p3);
\draw (p4) -- (p6);

\draw[dashed] (p1) -- (b1);
\draw[dashed] (p2) -- (b2);
\draw[dashed] (p3) -- (b3);
\draw[dashed] (p4) -- (b4);
\draw[dashed] (p5) -- (b5);
\draw[dashed] (p6) -- (b6);
\end{tikzpicture}}
Construct a bracket expression $\gb_P\of\gm$ of length $n$ as follows: order $P$ from left to right;
the $i$th bracket is opening if the $i$th point of $P$ is a left endpoint of $\gm$, and it is
closing otherwise.
This bracket expression is well-formed, since it can be constructed by starting from the
(well-formed) empty bracket expression, by successively inserting both brackets corresponding to
each edge, where the closing bracket will be inserted to the right of the opening bracket.

Given a well-formed bracket expression $B$ and a point set $P$, we will say that a perfect matching
$\gm$ is \emph{consistent with} $B$ if $\gb_P\of\gm = B$; moreover, we will refer to the points of
$P$ corresponding to opening brackets of $B$ as \emph{left-points} (since they will be left endpoints
of any perfect matching consistent with $B$), and similarly we will refer to the points of $P$
corresponding to closing brackets of $B$ as \emph{right-points}.

One approach to bounding the size of $\CFPM_P$ is to bound the size of
$\gb_P^{-1}\of{B}\Intersection \CFPM_P$ for bracket expressions $B$ of length $n$\idest the
number of crossing-free perfect matchings on $P$ consistent with $B$. We thus define
\[\gn_P\of B \DefineAs \Cardinality{\gb_P^{-1}\of{B}\Intersection \CFPM_P}\text.\]
In order to concisely refer to bracket expressions, we will use the notations
$\langle^k$ for $k$ successive opening brackets, and $\rangle^k$ for $k$ successive
closing brackets, for instance,\[
\langle^2\rangle\langle^2\rangle^3 = \langle\langle\rangle\langle\langle\rangle\rangle\rangle
\text.\]

[TODO a section or subsection or something here, talking about the trivial upper bounds on $\langle\rangle$,
and about the bound on a product of bracket expressions. Maybe about the boring stuff like
$\langle\langle\rangle E \rangle$, but frankly that's not very interesting]

[TODO cite the existing upper bound from Sharir--Welzl 2006 (the proof is unrelated to anything here
though)]
\subsection{An optimal lower bound for the number of crossing-free perfect matchings}
The following proof is due to A.~J.~Ruiz-Vargas and E.~Welzl \cite{RuizVargasWelzl2016}.
Let $P$ be a point set of size $n = 2k$ in general position with respect to the horizontal,
and let $B$ be a well-formed bracket expression of length $n$.
Then there exists a crossing-free perfect matching consistent with $B$; in other words,
$\gn_P\of B \geq 1$.
\begin{proof}
Let $\gm_0$ be a perfect matching on $P$ consistent with $B$. This is always possible, for instance,
parsing the bracket expression, match the point corresponding to an opening bracket
and the point corresponding to the matching closing bracket.

Define $l(m)$ for a perfect matching $m$ on $P$ to be the sum of the lengths of the edges of $m$.

\marginfig[\label{figUncrossing}Untangling in a perfect matching. Replacing the thick
edges by the thin ones reduces the total edge length, while preserving left and right endpoints.]{
\begin{tikzpicture}[scale=1]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\node[dot,label=below:$a$] at (0,0) (a) {};
\node[dot,label=above:$c$] at (-0.5,1) (c) {};
\node[dot,label=below:$d$] at (2,0.5) (d) {};
\node[dot,label=above:$b$] at (1.5,1.5) (b) {};

\draw (a) -- (d);
\draw (c) -- (b);
\draw[very thick] (a) -- (b);
\draw[very thick] (c) -- (d);
\end{tikzpicture}}
Then, repeat the following procedure, starting at $i=0$.
If there is no crossing in $\gm_i$, we have found a perfect matching with the desired properties.
If there is a crossing, let $a$, $b$, $c$, and $d$ be the points involved, so that the edge
$ab$ crosses the edge $cd$. Remove these edges, and replace them by $ad$ and $cb$
(thus untangling them). This yields another perfect matching $\gm_{i+1}$. By the triangle
inequality (see figure \ref{figUncrossing}), $l(\gm_{i+1})<l(\gm_i)$.

If this procedure did not terminate, it would yield a sequence $\tuple{\gm_i}_{i\in\N}$ of crossing
perfect matchings on $P$ on which $l$ is strictly decreasing, thus an infinite sequence of distinct
graphs on $P$.
Since there are only finitely many graphs on $P$, this is a contradiction, so we
eventually\footnote{The untangling procedure itself predates this proof, and was shown to terminate in
$\BigO\of{n^3}$ steps by J.~van~Leeuwen and A.~A.~Schoone in 1980 \cite{LeeuwenSchoone1981}.}
find a
crossing-free perfect matching.
\end{proof}
This immediately yields a lower bound for the number of crossing-free perfect matchings, since
there are $C_{\frac n 2}$ well-formed bracket expressions of length $n$.
Note that this lower bound had already been proved by A.~García, M.~Noy, and J.~Tejel in 1995,
by a recurrence that split the point set, rather than via well-formed bracket expressions
\cite{GarciaNoyTejel2000}.
\begin{corollary}
Let $P$ be a point set of size $n$ in general position. There are at least $C_{\frac n 2}$ distinct
crossing-free perfect matchings on $P$\idest $\Cardinality{\CFPM_P} \geq C_{\frac n 2}$.
\end{corollary}
Moreover, this lower bound is optimal, since it is attained if $P$ is in convex position (see
section~\ref{PerfectMatchingsIntro}).

Now that we have a tight uniform lower bound for $\gn_P$, we will start looking at upper bounds
dependent on the bracket expression.
\subsection{Matchings across a line}
Again we consider $n=2k$ points in general position with respect to the horizontal.
The matchings corresponding to brackets expressions with $k$ opening brackets followed
by $k$ closing brackets, $\langle^k\rangle^k$, are called \emph{matchings
across a line}. Indeed, any edge in such a matching will cross any vertical line that separates
the left-points from the right-points.

The following result, and its proof, were given by Micha Sharir and Emo Welzl in 2005 \cite{SharirWelzl2006}.
\NoEndMark
\begin{theorem}[Sharir--Welzl]
Let $P$ be a set of $n=2k$ points in general position with respect to the horizontal.
Then there are at most $C_{\frac n 2}^2$ crossing-free perfect matchings across a line on $P$\idest
$\gn_P\of {\langle^k\rangle^k} \leq C_k^2$.
\end{theorem}
The idea of the proof is as follows.
First, pick a vertical line that separates the left-points from the right-points;
we will call it \emph{the vertical line}.
Further, let us call the set of left-points $L$ and the set of right-points $R$.

A perfect matching across a line is uniquely defined by a bijection $\FunctionSpec \gm L R$ from
the left-points to the right-points. Consider such a matching, and let $E$ be the set of its edges.
Now, number the intersections between the edges of the perfect matching and the vertical
line from top to bottom. This yield a numbering $\FunctionSpec \gi E {[k]}$ of the edges.
\marginfig[Constructing the numberings $\gl$ and $\gr$ of the left- and right-points from
a crossing-free perfect matching across a line; here $\gi\of{\set{p,q}} = 2$, and thus
$\gl\of{p}=\gr\of q = 2$.\label{figConstructCFA}]{
\begin{tikzpicture}[scale=0.75]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\node[dot] at (-3,1.5) (l1) {};
\node[dot] at (-2,2) (l2) {};
\node[dot,label=below left:$p$] at (-0.5,3) (l3) {};
\node[dot,label=below right:$q$] at (0.5,3) (r1) {};
\node[dot] at (1,4.5) (r2) {};
\node[dot] at (2,0) (r3) {};


\node at (-3,-1) {$\langle$};
\node at (-2,-1) {$\langle$};
\node at (-0.5,-1) {$\langle$};
\node at (0.5,-1) {$\rangle$};
\node at (1,-1) {$\rangle$};
\node at (2,-1) {$\rangle$};

\node[inner sep=0pt,label=above left:$1$] at (0,3.75) {};
\node[inner sep=0pt,label=above right:$2$] at (0,3) {};
\node[inner sep=0pt,label=above right:$3$] at (0,1) {};

\draw (l1) -- (r2);
\draw (l2) -- (r3);
\draw (l3) -- (r1);

\draw[very thick] (0,5) -- (0,0);
\end{tikzpicture}}

Define $\gl\of l \DefineAs \gi\of{e_l}$ mapping a left-point to the intersection number of its
edge, and similarly $\gr\of r \DefineAs \gi\of{e_r}$ for the right-points. We have
$\gm = \gr^{-1} \Compose \gl$.

The bijection $\gl$ (respectively $\gr$) determines the order in which the left points (respectively right points)
reach the vertical line.

If the matching is crossing-free, we will show that
$\gl$ and $\gr$ have to be in sets of size $C_k$, thus that there are at most $C_k^2$ functions
$\gm = \gr^{-1} \Compose \gl$\idest that there can be at most $C_k^2$ perfect matchings across a line.

Since we are going to reuse these concepts in subsequent sections, we will formalize and name the properties of
$\gl$ and $\gr$ that we will consider.
\begin{definition}[crossing-free alignment]
Let $\gL$ be a set of $k$ points in general position. Let $V$ be a vertical line to the right of $\gL$.
A bijection from a set of $\gL$ to $k$ is a \emph{crossing-free left-alignment of $\gL$ on $V$} if
there exists a set $A=\setst{a_p}{p\in\gL}$ of $k$ non-crossing line segments such that
the following hold:
\begin{enumerate}
\item for every $p\in\gL$, the left endpoint of $a_p$ is $p$, and its right endpoint is on $V$;
\item no two segments share the same right endpoint;
\item let $\FunctionSpec \gi A {[k]}$ the numbering of the right endpoints of the segments in
$A$ from top to bottom, then $\gl\of p = \gi\of{a_p}$.
\end{enumerate}
Such a set of segments is said to \emph{realize} $\gl$.

Correspondingly, we define a \emph{crossing-free right-alignment}, where ``right'' and ``left'' are swapped in the
definition.
\end{definition}

\begin{lemma}
Let $\gL$ be a set of $k$ points in general position, and let $V$ be a vertical line to the right of $\gL$.
There are at most $C_k$ crossing-free left-alignments of $\gL$ on $V$.
\begin{proof}
Let $l$ be the leftmost point of $\gL$, and let $\gl$ be a crossing-free left-alignment of $\gL$ on $V$.
Let $A=\setst{a_p}{p\in\gL}$ be a set of non-crossing line segments realizing $\gl$.
For a point $p\in\gL$, we will call $a_p$ \emph{the segment of $p$}. We will refer to $V$ as
\emph{the vertical line}.

$\gl(l)$, being the index on the vertical line of the right endpoint of the segment $a_l$ of the leftmost point,
is equal to one plus the number of points of $\gL$ that are above $a_l$. Indeed, the segments of points above $a_l$ must
themselves reach the vertical line above $a_l$, otherwise they would cross $a_l$, and correspondingly for
points below $a_l$, so that there are as many edges reaching the vertical line below $a_l$ as there are points
below $a_l$.

Moreover, as the oriented angle between $a_l$ and the horizontal increases, points are only added to the
set of points below $a_l$, so that choosing the number of points below $a_l$ determines the sets of points
below and above $a_l$.

Further, since points above $a_l$ must reach the vertical line above $a_l$, and correspondingly for points below,
if the point $p$ is above $a_l$, then $\gl(p) < \gl(l)$, and if it is below, $\gl(p) > \gl(l)$. Thus
$\gl$ restricted do the points above $a_l$ is a crossing-free left-alignment of the $\gl(l) - 1$ points above
$a_l$, and $\gl-\gl(l)$ restricted to the points below $a_l$ is a crossing-free left-alignment of the
$k - \gl(l)$ points below $a_l$, where the appropriate subsets of $A$ provide the set of segments required
in the definition.

It follows that $\gl$ is determined by the choice of $\gl\of l$ and crossing-free left-align\-ments
of $\gl\of{l}-1$ and $k-\gl\of{l}$ points.
Letting $i\DefineAs \gl\of l - 1$, these are crossing-free alignments of $i$ and $k-i-1$ points (see
figure~\ref{figCrossingFreeAlignment}).
Therefore, if $\varpi_j$ is an upper bound for the number of crossing-free
left-alignments of $j$ points when $j < k$,
we can give an upper bound on the number of crossing-free left-alignments of $k$ points,
\[\varpi_k\DefineAs\sum{i=0}[k-1]\varpi_{i}\varpi_{k-i-1}\text.\]
We can start the recurrence with $\varpi_0 = 1$; this is the recurrence for the Catalan numbers, thus
$\varpi_k=C_k$.
\end{proof}
\end{lemma}
\marginfig[A crossing-free left-alignment of five points. Once the index of the leftmost point is chosen (thick segment),
the rest consists in two crossing-free left-alignments of $i$ and $k-i-1$
points each---here $k = 5$ and $i = 2$.\label{figCrossingFreeAlignment}]{
\begin{tikzpicture}[scale=0.75]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\node[dot] at (-5,2) (p1) {};
\node[dot] at (-4,1) (p2) {};
\node[dot] at (-3,3) (p3) {};
\node[dot] at (-2,1.5) (p4) {};
\node[dot] at (-1,3.5) (p5) {};

\node[inner sep=0pt,label=right:$1$] at (0,4) (l1) {};
\node[inner sep=0pt,label=right:$2$] at (0,3.5) (l2) {};
\node[inner sep=0pt,label=right:$3$] at (0,2.5) (l3) {};
\node[inner sep=0pt,label=right:$4$] at (0,1.5) (l4) {};
\node[inner sep=0pt,label=right:$5$] at (0,1) (l5) {};

\draw[->,very thick] (p1) -- (l3);
\draw[->] (p3) -- (l1);
\draw[->] (p5) -- (l2);
\draw[->] (p4) -- (l4);
\draw[->] (p2) -- (l5);

\draw[very thick] (0,5) -- (0,0);
\end{tikzpicture}}
The same results holds for crossing-free right-alignments, simply exchange ``left'' and ``right'' in the above
lemma and its proof.

\begin{proof}[of the theorem]
If we have a crossing-free perfect matching across a line, then $\gl$ as constructed above is a crossing-free
left-alignment of $L$ on the vertical line; indeed, letting $a_p$ be the portion of the edge $e_p$
to the left of the vertical line yields segments that realize $\gl$.
Similarly, $\gr$ is a crossing-free right-alignment of $R$ on the vertical line.
\end{proof}
\section{Analysing the overcounting in the upper bound for matchings across a line}
The bound given above for the number of matchings across a line is not optimal;
an example is given by Sharir and Welzl of a crossing-free left-alignment $\gl$ and a crossing-free
right-alignment $\gr$ such that $\gr^{-1}\Compose \gl$ is not crossing-free (see figure~\ref{crossingPMAL}).
\marginfig[Composing crossing-free alignments, only to get a crossing perfect
matching.\label{crossingPMAL}]{TODO}

There is however more to the overcounting than just counting some crossing matchings.
To characterize that, it helps to name some functions and sets. Again, are considering a
set $P$ of $2k$ points in general position with respect to the horizontal and the bracket
expression $\langle^k\rangle^k$.  We let $L$ be the set of left-points, and $R$ be the
set of right-points. Moreover, we pick a vertical line separating $L$ and $R$, and call it
$V$.

In the previous section, given a crossing-free perfect matching $\gm$, we constructed crossing-free
left- and right-alignments $\gl$ and $\gr$ (see figure~\ref{figConstructCFA}). Let us call that
construction $\gw$, thus $\gw\of{\gm}=\tuple{\gl, \gr}$. Moreover, let us call $\CFLA_{L,V}$ the
set of crossing-free left-alignments of $L$ on $V$, and $\CFLA_{R,V}$ the set of crossing-free
left-alignments of $R$ on $V$. Given sets of equal sizes $L$ and $R$,
$\gl\in\CFLA_{L,V}$, and $\gr\in\CFRA_{R,V}$,
let $c\of{\gl,\gr}$ be the (possibly crossing) perfect matching $\gr^{-1}\Compose\gl$.
Finally, let us name the sets of perfect matchings across a line and of
crossing-free perfect matchings across a line,
\begin{align*}
\PMAL_P &\DefineAs \gb_P^{-1}\of{\langle^k\rangle^k}\\
\CFPMAL_P &\DefineAs \PMAL_P \Intersection \CFPM_P\text.
\end{align*}
Then the following diagram commutes\idest constructing crossing-free alignments from a matching
and then composing them yields the initial matching.
\[\begin{tikzcd}
\CFPMAL_P \arrow{r}{\gw} \arrow[hook]{d}{\Subset} & \CFLA_{L,V}\Cartesian\CFRA_{R,V} \arrow{ld}{c} \\
\PMAL_P
\end{tikzcd}\]
The result of Sharir and Welzl consists in deducing from the commutative diagram that
$\gw$ must be injective, and so that\begin{equation}
\Cardinality{\CFPMAL_P} \leq
\Cardinality{\CFLA_{L,V}\Cartesian\CFRA_{R,V}}\text, \label{SharirWelzlOvercounting}
\end{equation}
and then a bound for the number of crossing-free alignments yields a bound for the number of
crossing-free matchings across a line.

\marginfig[Composing crossing-free alignments, and getting a crossing-free perfect matching,
but one that does not decompose to the original alignments.\label{figWeirdAligments}]{TODO}
The inequality (\ref{SharirWelzlOvercounting}) is strict, as shown in figure~\ref{crossingPMAL}.
We would thus like to study the pairs of crossing-free alignments which are \emph{not} in
the image of $\gw$, since they are responsible for that excess; we will call them \emph{overcounted}.
Overcounted pairs of crossing-free alignments fall into one of two categories;
\begin{enumerate}
\item
evidently, if $c\of{\gl,\gr}$ is crossing, then $\tuple{\gl,\gr}$ is not in the image of $\gw$,
since the diagram commutes;
\item on the other hand, figure~\ref{figWeirdAligments} shows a pair of
crossing-free alignments $\tuple{\gl,\gr}$ which composes to a crossing-free alignment
$\gm = c\of{\gl,\gr}$, but which is not equal to $\gw\of\gm$.
\end{enumerate}
In addition, we will call a crossing-free left alignment $\gl$ overcounted if any pair
$\tuple{\gl, \gr}$ is overcounted.

To hunt down overcounted crossing-free alignments, we will examine in more detail the anatomy of a crossing-free
left-aligment of $L$ and the proof of the Sharir--Welzl bound for the number of crossing-free left-alignments,
with some fresh definitions.

First, for a point set $L$, note that we can partition the half-plane to the right of $\leftmost\of L$ in
$\Cardinality L$ regions,
separated by rays emanating from $\leftmost\of L$ and going through other points of $L$. We will call those regions
\emph{left $L$-cones}, and number them from top to bottom from $1$ to $\Cardinality L$, see figure~\ref{figCones}.
Note that there are $i$ points of $L$ above the interior of left $L$-cone
number $i+1$, and $\Cardinality L - i - 1$ points below.

Given a crossing-free left-alignment $\gl$ of $L$ on $V$, for any set of segments $A=\setst{a_p}{p\in L}$
realizing $\gl$, the segment $a_{\leftmost\of L}$ of the leftmost point then has to be contained in left
$L$-cone number $\gl\of{\leftmost\of L}$.
As we remarked in the previous section, for a crossing-free perfect matching $\gm$, the edges of $\gm$ restricted
to the left side of $V$ realize the left-alignment in $\gw\of\gm$. Thus if $\tuple{\gl, \gr}$ is in the image of
$\gw$, $\leftmost\of L$ has to be matched to a right-point in left $L$-cone number $\gl\of{\leftmost\of L}$, see
figure~\ref{figConesNeedPoints}.

To extend this reasoning beyond the leftmost point of $L$, we define \emph{left conifers of $L$}.
A left conifer $\gk$ of a point set $L$ is a map from points in $L$ to left $S$-cones for subsets $S$ of $L$,
satisfying the following properties:
\begin{enumerate}
\item $\gk\of{\leftmost\of L}$ is a left $L$-cone;
\item $\gk$ restricted to the points above the interior of $\gk\of{\leftmost\of L}$ is a left conifer of these points;
\item $\gk$ restricted to the points below the interior of $\gk\of{\leftmost\of L}$ is a left conifer of these points.
\end{enumerate}
See figure~\ref{figLeftconifer} for an example.
We call $\LC_L$ the set of left conifers of $L$. From the observations above on the number of cones and the
size of the sets of points above and below their interiors, if $\gcp_k$ is the number of left conifers of $k$ points,
we have
\[
\gcp_k=\sum{i=0}[k-1]\varpi_{i}\varpi_{k-i-1} \text{ and } \gcp_0=1\text,
\]
so that $\Cardinality{\LC_L} = C_{\Cardinality L}$.

\newcommand{\conification}{\mathscr{k}}
Recall that a crossing-free left-alignment $\gl$ is determined by the value of $\gl\of{\leftmost\of L}$ and by
crossing-free left alignments
of the points above and below any edge realizing $\gl$\idest above and below cone number $\gl\of{\leftmost\of L}$.
This is equivalent to choosing left $L$-cone number $\gl\of{\leftmost\of L}$,
and recursively doing so in the point subsets above and below the
interior of that cone, see figure~\ref{figRecursiveconifer}.
This gives an injective map $\FunctionNamedBody\conification\gl{\conification_\gl}$
from crossing-free left-alignments of $L$ on any line to left conifers. 
Note that it is not bijective, see figure~\ref{crossingconifer}.

In turn, this yields $\Cardinality{\CFLA_{L,V}}\leq\Cardinality{\LC_L}=C_{\Cardinality L}$, which is exactly the
Sharir--Welzl bound.

Now, note that
the map $\conification$ has the property that for any set of segments $A=\setst{a_p}{p\in L}$ realizing $\gl$,
$a_p$ lies inside the cone $\conification_\gl\of{p}$; since the edges of a matching $\gm$ realize the crossing-free
aligrments $\gw\of{\gm}$, $\conification_\gl\of{p}$ must contain the right-point to which $p$ is matched.
\section{Highly convex matchings across a line}
In particular, this means that if there is no right-point in $\conification_\gl\of{p}$,
then $\gl$ is overcounted.
We will call \emph{vacuous} a left cone that does not contain any right-points,
and we will call vacuous a left conifer that has vacuous cones; thus $\gl$ is overcounted
if $\conification_\gl$ is vacuous.

We will now use convexity considerations to give an upper bound on the number of non-vacuous left conifers.
Let us first define some concepts related to convex hulls.
Given a set of points $P$ in general position, the \emph{extreme points of $P$} are the points of $P$ that
are in the boundary of the convex hull of $P$.
Given a set of points $L$ in general position with respect to the horizontal and a set of points $R$
in general position with respect to the horizontal to the right of $L$,
the \emph{$R$-liminary points of $L$} are the points of $L$ which are extreme points of $L\Union R$,
see figure~\ref{figLiminaryPoints}.
We will call $\leftmost\of L$ the leftmost point of $L$; note that it is an $R$-liminary point of $L$.

Note that in polar order around $\leftmost\of L$, the $R$-liminary points of $L$ other than $\leftmost\of L$ are separated by
$R$, that is, in polar order, one subset of the $R$-liminary points of $L$ appears first, followed by
all points of $R$, followed by the rest of the $R$-liminary points of $L$ (except $\leftmost\of L$).
We will call those $R$-liminary points of $L$ which appear below $R$ the \emph{lower $R$-liminary points of $L$},
and those that appear above $R$ the \emph{upper $R$-liminary points of $L$}.

If there are $\gd_1$ upper $R$-liminary points of $L$, then the first $\gd_1$ left $L$-cones are vacuous.
Similarly, if there are $\gd_2$ lower $R$-liminary points of $L$, then the last
$\gd_2$ left $L$-cones are vacuous. Moreover, for any non-vacuous left $L$-cone $\gk$, any upper $R$-liminary points
of $L$ are $R$-liminary points of the
subset of $L$ above $\gk$, and any lower $R$-liminary points of $L$ are $R$-liminary points of the
subset of $L$ below $\gk$, so that we get the recurrence
\[\varpi_{k,\gd}\DefineAs\max_{\gd_1+\gd_2=\gd-1}\sum{i=\gd_1}[k-\gd_2-1]\varpi_{i,\gd_1}\varpi_{k-i-1,\gd_2}\text,\]
where $\varpi_{k,\gd}$ is an upper bound on the number of crossing-free non-vacuous left conifers of $k$ points
of which at least $\gd$ are $R$-liminary.
Moreover, we can start that recurrence with
\begin{align*}
\varpi_{k,0}&\DefineAs\varpi_{k,1}\text,\\
\varpi_{k,k}&\DefineAs1\text,
\end{align*}
since there is at least one $R$-liminary point of $L$ (the leftmost one), and if all points are $R$-liminary,
only one cone is non-vacuous.
\section{Three changes of bracket direction}
We now consider left-right matchings corresponding to bracket expressions which have three
changes of bracket directions\idest bracket expressions of the form
$\langle^k\rangle^l\langle^q\rangle^p$,
$k$ opening brackets, $l$ closing brackets, $q$ opening brackets, $p$ closing brackets, where
$k-l=p-q\geq 0$ and $k+l+p+q\DefinitionOf n$.

In term of points, this means that four sets can be separated by vertical lines, from left
to right, $k$ left-points forming the set $K$, $l$ right-points forming $L$, $q$ left-points
forming $Q$, and $p$ right-points forming $P$.
We pick a vertical line separating $K$ and $L$ and call it \emph{the left line}, and we pick
a vertical line separating $P$ and $Q$ and call it \emph{the right line}.

Given a crossing-free perfect matching on those points, numbering from top to bottom the
intersections between edges incident to the points of $K$ and and the left line,
we get a crossing-free left-alignment of $K$. $k-l$ of the $k$ edges on this vertical
line are incident to points in $P$; the other $l$ are incident to points in $L$.
Numbering those $l$ edges yields a crossing-free right-alignment $\gl$ of $L$.

Similarly on the right side, we get a crossing-free right-alignment of $\gp$ of $P$,
numbering the subset of edges incident to a point in $P$ and a point in $Q$, we get a
left-alignment $\gq$ of $q$.
\begin{figure}[!ht]
\centering
\begin{tikzpicture}[scale=0.5]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.25]
\node[dot] at (-9,1.9) (k1) {};
\node[dot] at (-8,1) (k2) {};
\node[dot] at (-7,4) (k3) {};
\node[dot] at (-6,3) (k4) {};
\node[dot] at (-5,0) (k5) {};

\node[dot] at (-3.5,1.5) (l1) {};
\node[dot] at (-2.5,0.5) (l2) {};
\node[dot] at (-1.5,2.5) (l3) {};
\node[dot] at (-0.5,3) (l4) {};

\node[dot] at (0.5,3.7) (p1) {};
\node[dot] at (1.5,0) (p2) {};
\node[dot] at (2.5,1) (p3) {};
\node[dot] at (3.5,2.8) (p4) {};

\node[dot] at (5,2.5) (q1) {};
\node[dot] at (6,0.5) (q2) {};
\node[dot] at (7,3.5) (q3) {};
\node[dot] at (8,1.5) (q4) {};
\node[dot] at (9,2.1) (q5) {};

\draw[very thick, name path=left line] (-4.25,5) -- (-4.25,-1);
\draw[very thick, name path=right line] (4.25,5) -- (4.25,-1);

\draw[gray, name path=edge] (k1) -- (q5);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (k1) -- (align);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (q5) -- (align);


\draw[gray, name path=edge] (k3) -- (l4);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (k3) -- (align);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (l4) -- (align);

\draw[gray, name path=edge] (k2) -- (l1);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (k2) -- (align);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (l1) -- (align);

\draw[gray, name path=edge] (k4) -- (l3);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (k4) -- (align);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (l3) -- (align);

\draw[gray, name path=edge] (k5) -- (l2);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (k5) -- (align);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (l2) -- (align);


\draw[gray, name path=edge] (q1) -- (p4);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (q1) -- (align);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (p4) -- (align);

\draw[gray, name path=edge] (q2) -- (p2);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (q2) -- (align);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (p2) -- (align);

\draw[gray, name path=edge] (q3) -- (p1);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (q3) -- (align);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (p1) -- (align);

\draw[gray, name path=edge] (q4) -- (p3);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (q4) -- (align);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (p3) -- (align);

\node at (-9,-1) {$\langle$};
\node at (-8,-1) {$\langle$};
\node at (-7,-1) {$\langle$};
\node at (-6,-1) {$\langle$};
\node at (-5,-1) {$\langle$};

\node at (-7,5) {$K$};

\node at (-3.5,-1) {$\rangle$};
\node at (-2.5,-1) {$\rangle$};
\node at (-1.5,-1) {$\rangle$};
\node at (-0.5,-1) {$\rangle$};

\node at (-2,5) {$L$};
\node at (2,5) {$Q$};

\node at (0.5,-1) {$\langle$};
\node at (1.5,-1) {$\langle$};
\node at (2.5,-1) {$\langle$};
\node at (3.5,-1) {$\langle$};

\node at (7,5) {$P$};

\node at (5,-1) {$\rangle$};
\node at (6,-1) {$\rangle$};
\node at (7,-1) {$\rangle$};
\node at (8,-1) {$\rangle$};
\node at (9,-1) {$\rangle$};
\end{tikzpicture}
\caption{Four crossing-free alignments.\label{figCFPMklqp}}
\end{figure}

The matching is uniquely determined by $\gk$, $\gp$, the choice of
the $k-l$ among $k$ points and $k-l=p-q$ among $p$ points that get matched to each other,
and by $\gl$ and $\gq$, which gives the following bound for the number of these matchings:\[
\gn_P\of{\langle^k\rangle^l\langle^q\rangle^p}
\leq C_k \binom k l C_l C_q \binom p q C_p\text.\]
Asymptotically, the factor involving $k$ and $l$ is\[
C_k \binom k l C_l
\preccurlyeq
4^{k+l} \binom k l
\preccurlyeq
4^{k+l}
\pa{
\pa{\frac
  {\pa{1-\ga}^{1-\frac 1 \ga}}
  {\ga}}^{\pa{\frac{\ga}{\ga+1}}}}^{k+l}\text,
\]
where $l=\ga k$. The base of the exponential bound for the binomial coefficient is maximal
when $\ga = \frac{3-\sqrt{5}}{2}$, where it is $\GoldenRatio = \frac{1+\sqrt{5}}{2}$.
This gives the overall bound\[
\gn_P\of{\langle^k\rangle^l\langle^q\rangle^p}
\preccurlyeq
4^{k+l}
\GoldenRatio^{k+l}
4^{p+q}
\GoldenRatio^{p+q}
= \pa{4\GoldenRatio}^n
\approx 6.472^n\text.
\]
\subsection{Improving the binomial bound}
We can however improve upon that bound: indeed, once $\gk$, $\gp$, and the set of points
of $K$ matched to $P$ are fixed, the edges of the matching that cross both the left line
and the right line---let us call these \emph{long edges}---are determined. As a result,
the region between the left line and the
right line is partitioned in trapezoidal cells, and the portion of any edge from $K$ to $L$ and
from $P$ to $Q$ that lies between the left line and the right line is confined to a
single of those cells. It follows that $\gl$ is composed of crossing-free
right-alignments the of subsets of $L$ separated by the long edges, and similarly for $\gq$
with subsets of $Q$ (in figure~\ref{figCFPMklqp}, there is one long edge, and thus two cells).

Let us look at the edges crossing the left line (the same argument applies to the right line),
numbered from top to bottom: $k-l$ of those are
long edges, let $S \Subset [k]$ be their numbers; in between two long edges, above the first
long edge, and below the last one, we have the edges that define the crossing-free right-alignments
that make up $\gl$. It follows that a crossing-free right-alignment of $m$ points that makes up
$\gl$ corresponds to a maximal sequence of $m$ consecutive elements of $[k] \setminus S$.

We will call the set of maximal sequences of consecutive elements of $S'$ the \emph{cells} of
$S'$, written $\cells\of{S'}$.

Then, we can improve the $\binom k l C_l$ factor in the bound (in which the binomial comes from
the choice of the long edges amongst the $k$ edges on the left line, and the Catalan number comes
from the choice of $\gl$), summing over the choices of the long edges (and thus of $S$ above).
The improved factor becomes\begin{equation}
\spc\of{k, l}\DefineAs
\sum{S\in\binom{[k]}{k-l}} \quad \prod{c\in\cells\of{[k] \setminus S}}C_{\Cardinality c} =
\sum{S'\in\binom{[k]}{l}} \quad \prod{c\in\cells\of{S'}}C_{\Cardinality c}\text,
\label{spcDefinition}
\end{equation}
and the overall bound becomes\begin{equation}
\gn_P\of{\langle^k\rangle^l\langle^q\rangle^p}\leq
C_k\spc\of{k, l}\spc\of{p, q}C_p\text.\label{bound-ck-spckl-spcpq-cp}
\end{equation}

\subsection{A recurrence}
In order to compute $\spc$ efficiently, and eventually, get its asymptotics, it is useful to get rid
of the $\cells$ function. We can express $\spc$ as a recurrence instead.
First, we note that $\spc\of{k,k} = C_k$: there is only one summand, $S'$ is the whole set, so
it has only one cell, namely itself.
Otherwise, $k-l\geq 1$; in the sum over the $S$, consider the greatest element $j$ of $S$, which is at least
$k-l$, and split the sum over that,
\[\spc\of{k, l} = \sum{j=k-l}[k]\quad
\sum{\substack{S\in\binom{[k]}{k-l} \\ j=\max S}} \quad
\prod{c\in\cells\of{[k] \setminus S}}C_{\Cardinality c}\text.
\]
For fixed $j$, all summands (of the sum over $S$) will have a factor
with $c=\set{j+1,\dotsc,k}$, and thus a factor of
$C_{k-j}$. Factoring out this $C_{k-j}$, we get
\[\spc\of{k, l} = \sum{j=k-l}[k]
C_{k-j} \quad
\sum{\substack{S\in\binom{[k]}{k-l} \\ j=\max S}} \quad
\prod{\substack{c\in\cells\of{[k] \setminus S} \\ c\neq\set{j+1,\dotsc,k}}}
    C_{\Cardinality c}\text.
\]
Now, note that choosing a subset $S$ of $[k]$ of size $k-l$ whose maximum is $j$ is equivalent to choosing
a subset $s$ of $[j-1]$ of size $k-l - 1$, where $S=s\Union\set{j}$. Moreover, the cells of $[k]\setminus S$ other
than $\set{j+1,\dotsc,k}$ are exactly the cells of $[j-1]\setminus s$, thus
\[\spc\of{k, l} = \sum{j=k-l}[k]
C_{k-j} \quad
\sum{s\in\binom{[j-1]}{k-l - 1}} \quad
\prod{c\in\cells\of{[j-1]\setminus s}}
    C_{\Cardinality c}\text.
\]
By definition of $\spc$, this means
\[\spc\of{k, l} = \sum{j=k-l}[k]
C_{k-j}
\spc\of{j-1,l+j-k}\text.
\]
Rewriting this as a sum over $i\DefineAs k-j$, this gives us the following recurrence for $\spc$:
\begin{align}\spc\of{k, l} &= \sum{i=0}[l]
C_{i}
\spc\of{k-i-1,l-i} &\text{for $l<k$,} \label{spcRecurrence1}\\
\spc\of{k, k} &= C_k \label{spckk}\text.
\end{align}\marginfig[The first few values of $\spc$; $k$ vertically from $0$ to $5$,
$l$ horizontally from $0$ to $k$. The $l+1$ summands in the recurrence (\ref{spcRecurrence1})
with $k = 6$ and $l = 3$ are highlighted.]{
$\begin{array}{r r r r r r}
1 \\
{\color{red}1} & 1 \\
1 & {\color{red}2} &  2 \\
1 & 3 &  {\color{red}5} & 5 \\
1 & 4 &  9 & \tn{lastSummand}{\color{red}$14$} & 14 \\
1 & 5 & 14 & \tn{result}{$28$} & 42 & 42
\end{array}$
\tikz[remember picture,overlay]
    \path[->] (lastSummand.south) edge (result.north -| lastSummand.south);
}
\subsection{A better recurrence}
We can now turn this recurrence into a simpler recurrence, which we will prove by recurrence.

Since $\spc$ has not been formally defined for negative arguments, we extend the definition
with $\spc\of{k,l}=0$ for $l<0$; this is consistent with the definition, since it yields a sum over
subsets $S\Subset [k]$ bigger than $k$, and it yields an empty sum in the recurrence we just derived.
In addition to that, we also let $\spc\of{k,l} = 0$ when $l > k$.

Note that for $k - 1 = l\geq 0$, we have\begin{align}
\spc\of{k, l}
= \sum{i=0}[l]C_{i}\spc\of{k-i-1,l-i} = \sum{i=0}[l]C_{i}\spc\of{l-i,l-i} 
&= \sum{i=0}[l]C_{i}C_{l-i} \nonumber \\
&= C_{l+1}\text,\label{spckkminusone}
\end{align}
and thus 
\begin{equation}
\spc\of{k, l} = \spc\of{k-1, l} + \spc\of{k, l-1} = C_k \text{ for $k = l > 0$.}
\end{equation}
Further, for $k - 1 = l$, we get
\begin{align}
\spc\of{k, l}
&= \sum{i=0}[l]C_{i}C_{l-i} = C_l + \sum{i=0}[l-1]C_{i}C_{((l-1)-i)+1} \nonumber\\
\intertext{applying (\ref{spckk}) on the left and (\ref{spckkminusone}) on the right,}
&= \spc\of{k-1, l} + \sum{i=0}[l-1]C_{i}\spc\of{k-i-1,(l-1)-i} \nonumber\\
&= \spc\of{k-1, l} + \spc\of{k,l-1}\text.
\end{align}

Now let $k - 1 > l \geq 0$.
Assume $\spc\of{k',l'}=\spc\of{k'-1,l'}+\spc\of{k',l'-1}$ for $0\leq l'<k'<k$.
Then we can apply this assumption to the summands of $\spc\of{k, l}$:
\begin{align}
\spc\of{k, l} &= \sum{i=0}[l]
C_{i}
\spc\of{k-i-1,l-i} \nonumber \\
&= \sum{i=0}[l]
C_{i}
\pa{\spc\of{k-i-2,l-i}+\spc\of{k-i-1,l-i-1}} \nonumber \\
&= \sum{i=0}[l]
C_{i}\spc\of{k-i-2,l-i}
+\sum{i=0}[l]C_{i}\spc\of{k-i-1,l-i-1} \nonumber \\
&= \sum{i=0}[l]
C_{i}\spc\of{(k-1)-i-1,l-i}
+\sum{i=0}[l-1]C_{i}\spc\of{k-i-1,(l-1)-i} \\&\phantom{=}\qquad + C_{l}\spc\of{k-l-1,-1}\text, \nonumber \\
\intertext{so, substituting the recurrence for $\spc$,}
&= \spc\of{k-1, l} + \spc\of{k,l-1}\text.
\end{align}
We thus have the following recurrence for $\spc$:
\begin{align}
\spc\of{k,l} &= \spc\of{k-1, l} + \spc\of{k,l-1} & \text{for $k\geq 1$, $0\leq l \leq k$,}\label{spc-catalan-triangle}\\
\spc\of{k,l} &= 0 & \text{for $l < 0$ or $l > k$,}\\
\spc\of{0,0} &= 1\text.
\end{align}\marginfig[The recurrence (\ref{spc-catalan-triangle}).]{
$\begin{array}{r r r r r r}
1 \\
1 & 1 \\
1 & 2 &  2 \\
1 & 3 &  5 & 5 \\
1 & 4 &  9 & \tn{summandAbove}{$14$} & 14 \\
1 & 5 & \tn{summandLeft}{$14$} & \tn{result}{$28$} & 42 & 42
\end{array}$
\tikz[remember picture,overlay]
    \path[->] (summandAbove.south) edge (result.north -| summandAbove.south)
              (summandLeft) edge (result);
}
This is the recurrence defining the Catalan triangle\footnote{[TODO cite something that actually uses that
name here]}, and its solution is known, namely
\begin{equation}
\spc\of{k,l} = \frac
{\Factorial{\pa{k+l}} \pa{k-l+1}}
{\Factorial l \Factorial{\pa{k+1}}}
= \frac{k-l+1}{k+1} \binom{k+l}{k}\label{spc-solution}
\text,
\end{equation}
as shown by L.~F.~A.~Arbogast in 1800 \cite[p.~214--217]{Arbogast1800}.
\subsubsection{A combinatorial interpretation of $\spc$}
The Catalan triangle counts well-formed prefix bracket expressions [CITATION]. This can in fact be seen from
all the definitions of $\spc$ above, thus providing a more combinatorial solution.

In the original definition (\ref{spcDefinition}) of $\spc$, the sum is over the choices for the positions of the
unmatched $k-l$ opening brackets; between those, well-formed bracket expressions (counted by Catalan numbers) are
inserted.

The first recurrence (\ref{spcRecurrence1}) corresponds to the following grammatical
definition\footnote{This grammar requires infinite look-ahead to parse, but doing a first pass to mark the
unmatched opening brackets resolves that.} of well-formed
prefixes, where again wfbe denotes a well-formed bracket expression:
\begin{align*}
\text{wfprefix} \Coloneq
& \text{wfbe} \langle \text{wfprefix} \\
\mid\: & \text{wfbe},
\end{align*}
where the sum ranges over the length of the well-formed bracket expression preceding the first unmatched bracket.

Finally, (\ref{spc-catalan-triangle}) reflects the fact that a well-formed prefix with $k$ opening brackets
and $l$ closing brackets either ends with an opening bracket (preceded by a well-formed prefix with $k-1$ opening
and $l$ closing brackets), or with a closing bracket (preceded by a well-formed prefix with $k$ opening
and $l-1$ closing brackets).
\subsection{Asymptotics}
We can now use the expression (\ref{spc-solution}) for $\spc$ to study the asymptotics of the bound
(\ref{bound-ck-spckl-spcpq-cp}).
We are interested in the asymptotics as a function of the length of of the bracket expression $n = k+l+p+q$.
Since the bound is a product of two identical two-parameter factors, we study one of them,\[
C_k\spc\of{k,l}\text,
\]
as a function of $n_1\DefineAs k+l$. Let $l = \ga k$, thus $0\leq \ga\leq 1$,
the above expression becomes \[
C_{\frac{n_1}{\ga + 1}} \binom{n_1}{\frac{n_1}{\ga + 1}} \frac{\pa{1-\ga}n+\ga+1}{n+\ga+1}\text.
\]
Asymptotically as $n_1\longrightarrow \infty$, this yields\[
\frac
  {1}
  {n_1\sqrt{\Pi n_1}}
4^{\frac{n_1}{\ga + 1}}
\frac
  {\sqrt{1+\ga}}
  {\sqrt{2\Pi n_1 \ga}}
\pa{
  \frac
    {1+\ga}
    {\ga^{\frac{\ga}{\ga + 1}}}}^{n_1}
\pa{1-\ga}\text,
\]
or, up to a polynomially-bounded factor,\[
4^{\frac{n_1}{\ga + 1}}
\pa{
  \frac
    {1+\ga}
    {\ga^{\frac{\ga}{\ga + 1}}}}^{n_1}
=
\pa{
4^{\ga + 1}
\frac
  {1+\ga}
  {\ga^{\frac{\ga}{\ga + 1}}}}^{n_1}\text.
\]
As $\ga$ ranges from $0$ to $1$, the base of that exponential reaches a maximum of $5$ at
$\ga=\frac 1 4$. We thus have the following asymptotic bound.\begin{equation}
\gn_P\of{\langle^k\rangle^l\langle^q\rangle^p}\leq
C_k\spc\of{k, l}\spc\of{p, q}C_p
\preccurlyeq
5^{k+l}5^{p+q} = 5^n
\text.
\end{equation}
[TODO: would it be interesting or feasible to average over all $\langle^k\rangle^l\langle^q\rangle^p$,
for fixed $n$?]
[TODO: here a section about spc generalizing to arbitrary WFBEs, and the applicability of overcounting
analyses]
\clearpage
\nocite{*}
\bibliography{crossing-free-perfect-matchings}
\bibliographystyle{plain}

\end{document}
