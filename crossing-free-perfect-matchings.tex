\documentclass[10pt, a4paper, twoside]{basestyle}

\usepackage{tikz}
\usetikzlibrary{cd}
\usetikzlibrary{calc}
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{intersections}
\usetikzlibrary{backgrounds}
\usepackage{tikz-qtree}
\usepackage{braids}

\usepackage[Mathematics]{semtex}

%%%% Shorthands.
\newcommand{\idest}{\emph{, i.e.,\ }}
\newcommand{\etc}{\emph{etc}}

\DeclareMathOperator{\cells}{cells}
\DeclareMathOperator{\spc}{spc}
\DeclareMathOperator{\PM}{PM}
\DeclareMathOperator{\CFPM}{CFPM}
\DeclareMathOperator{\PMAL}{PMAL}
\DeclareMathOperator{\CFPMAL}{CFPMAL}
\DeclareMathOperator{\CFLA}{CFLA}
\DeclareMathOperator{\CFRA}{CFRA}
\DeclareMathOperator{\leftmost}{lm}
\newcommand{\LC}[1]{\mathrm{LC}_{#1}}
\newcommand{\CatalanNumber}[1]{\StandardSymbol C_{#1}}
\newcommand{\pointset}{\symscr}
\newcommand{\lcone}[1]{\mathscr{k}_{\pointset L, #1}}
\newcommand{\conification}{\mathfrak{K}}

\newcommand*{\tn}[2]{\tikz[baseline,remember picture]\node[inner sep=0pt,anchor=base] (#1) {#2};}

%%%% Title and authors.

\title{%
\textdisplay{%
On the number of crossing-free perfect matchings with designated left and right endpoints%
}%
}
\author{Robin~Leroy}
\begin{document}
\maketitle
\begin{abstract}
[TODO main results: the spc bound, the bound dependent on the number of interior points.
Do I mention the expressions for the Catalan triangle (are they known)?]
\end{abstract}

\section*{Introduction}
In the study of plane embeddings of planar graphs, also known as plane graphs,
embeddings with non-crossing straight edges (called crossing-free geometric graphs) are of particular
interest.
For instance, it is known \cite{LeeuwenSchoone1981} that any optimal solution to the travelling salesman problem in the
Euclidean plane has non-crossing straight edges.
In 1936, K.~Wagner proved\footnote{This result was independently proved by I.~Fáry in 1948 [CITE], and by
S.~K.~Stein in 1951 [CITE]; it is generally known as Fáry's theorem.} [CITE] that any planar graph has such an
embedding.

A natural enumerative question is then, given a vertex set of $n$ points in the Euclidean plane,
to bound the number of plane graphs of a certain sort (cycles, matchings, \etc.) which can be
drawn with non-crossing straight edges.
For spanning cycles, the question was introduced by M.~Newborn and W.~O.~J.~Moser in 1976 \cite{NewbornMoser1980},
and a super-exponential upper bound was given.
In 1980, M.~Ajtai, V.~Chvátal, M.~Newborn, and E.~Szemerédi \cite{AjtaiChvatalNewbornSzemeredi1982}
proved that there are only exponentially many crossing-free geometric graphs on a given point set.

Exponential bounds for various sorts of graphs were then improved, in particular for triangulations---the
maximal crossing-free geometric graphs. One of the interesting features of triangulations is that finding a bound for
them yields a bound for the overall number of crossing-free geometric graphs. [TODO citation] In addition,
bounds on the number of triangulations
are of interest in geometric modeling [CITE Studies in computational geometry motivated by mesh generation].

Some special configurations of points are better understood; in particular, for point sets in convex position,
the numbers of crossing-free perfect matchings, triangulations, and spanning cycles are known. In fact, the study
of point sets in convex position vastly predates the general problem, with the number of triangulations given by
Euler in 1751 \cite{Euler1751}.

For perfect matchings, an optimal lower bound of $\CatalanNumber {\frac n 2}$ was obtained as early as 1995 by A.~García,
M.~Noy, and J.~Tejel \cite{GarciaNoyTejel2000}; upper bounds have been harder to come by, with the best one
yet being asymptotically $10.05^n$, given by M.~Sharir and E.~Welzl in 2005 \cite{SharirWelzl2006}
In that same work, an upper bound of $5.83^n$ is given for the number of crossing-free perfect matchings on a
point set whose points are designated as left or right endpoints; moreover, an upper bound of $4^n$ is given
when all the left endpoints are to the left of the right endpoints (matchings across a line).

In this thesis, 
we start by giving an overview of some of the existing results, in particular a way
to classify arrangements of designated left and right endpoints,
and we restate the proof of the bound for matchings across a line by M.~Sharir and E.~Welzl
(section~\ref{sectionBackground}).
We then study in detail the inequalities in that bound and the objects it actually counts,
yielding criteria that will allow us to tighten the bound in specific cases (section~\ref{sectionOvercounting}).
Using these criteria, we give a bound for
matchings across a line that depends on the number of points in the interior of the convex hull
(section~\ref{sectionHighlyConvex}).
We then give new bounds on the number of crossing-free perfect matchings on a point set with designated left and
right endpoints for a specific family of left-to-right orderings of the left and right endpoints
(\ref{sectionThreeChanges}). 
\section{Background}
\label{sectionBackground}
We first give some definitions, as well as existing proofs whose ideas we will use to derive our results.
\subsection{Geometric graphs}
\begin{definition}[geometric graph]
Given a set of points $\pointset P$ in the Euclidean plane $\R^2$,
a \emph{geometric graph} is a collection of straight line segments (edges)
whose endpoints are elements of $\pointset P$.

It can be described as a simple graph (in the combinatorial sense)
on the vertices $\pointset P$, where the edge $\set{v,w}$ corresponds to the segment joining
$v$ and $w$.
\end{definition}
\begin{definition}[crossing-free]
A geometric graph is \emph{crossing-free} if no two edges share points other than
their endpoints; it is called \emph{crossing} otherwise.
\end{definition}
Note that being crossing-free implies that the corresponding simple graph is planar, and that the
geometric graph is a plane embedding.
\begin{sloppypar}
\begin{definition}[triangulation]
A \emph{triangulation} is a maximal crossing-free geometric graph, that is,
geometric graph such that for all $v$ and $w$ in $\pointset P$ that are not joined by a
segment, adding the segment joining $v$ and $w$ would result in a crossing
geometric graph.
\end{definition}
Note that the faces (in the sense of plane graphs) formed by a triangulation are
all triangles, with the possible exception of the outer face (thus this definition
is \emph{not} equivalent to that of a triangulation of the $2$-sphere).
\end{sloppypar}

Since a geometric graph corresponds to a simple graph on the underlying point set,
we can also look at geometric graphs that belong to special classes of simple graphs.
As we will only be focusing on geometric graphs, we simply call
\emph{perfect matching}
a geometric graph which corresponds to a perfect matching in the combinatorial sense.

As outlined in the introduction, we are interested in statements regarding the number
of geometric graphs, possibly restricted to a certain type, on a given point set.
Evidently, that number would depend on the choice of the point set $\pointset P$, so instead we seek
bounds on that number depending on the cardinality $\Cardinality P$, and possibly
restricting $\pointset P$ so that it satisfies certain properties.

An important property that $\pointset P$ can have is general position. We say that 
a point set in the plane is \emph{in general position} if no three points are collinear.
In this thesis we will only study point sets in general position.

In general, if $g\of {\pointset P}$ is the number of geometric graphs of a certain sort on the point
set $\pointset P$, we will look for lower bounds $l$ and upper bounds $u$ of the form\[
\forall n\in \N, \forall \pointset P \text{ such that } \Cardinality {\pointset P} = n,
l \of n \leq g \of {\pointset P} \leq u \of n \text,\]
where $\pointset P$ runs over all point sets that satisfy the relevant properties.

\subsection{Asymptotics}
In addition, we will want asymptotics on such bounds $l$ and $u$, to compare them with
existing results. Since the bounds are often exponential, we tend to ignore polynomial
factors. We will thus write that\[
u \of n \preccurlyeq_n f \of n
\]
if for some polynomial $p$, $\forall n\in \N, u\of n \leq p\of n f \of n$.

In some cases, we may be interested in classes of functions $g_z\of{\pointset P}$
which depend on some parameter $z\in\gW_n$.
For instance, $g_z$ could count crossing-free graphs on $\pointset P$ that contain a clique of size
$z\in [n]$.
In this thesis, we will often use classes $g_z$ with $z$ being the left-to-right ordering
of designated left and right endpoints.

When giving exponential bounds in $n$ for these parameterized classes of graphs, we will want to keep
track of the growth due to $z$. We will write that\[
u \of {n,z} \preccurlyeq_n f \of {n,z} \text{ \emph{uniformly in $z\in\gW_n$}}\]
if for some polynomial $p$ (that does not depend on $z$),
\[\forall n\in \N,\forall z \in \gW_n, u\of {n,z} \leq p\of n f \of {n,z}\text.\]
If $f \of {n,z}$ admits a supremum $\bar f \of {n}$ in $z\in\gW_n$ for all $n$, this implies
that $u\of {n,z} \leq p\of n \bar f \of{n}$, giving an upper bound truly independent of $z$.

Moreover, we will write $g \of {\pointset P}\preccurlyeq_{\Cardinality{\pointset P} = n} f\of n$ if
for some $u\of n\preccurlyeq_n f\of n$,\[
\forall n\in \N, \forall \pointset P \text{ such that } \Cardinality {\pointset P} = n,
g \of {\pointset P} \leq u \of n\text.\]
Similarly, we will write $g_z \of {\pointset P}\preccurlyeq_{\Cardinality{\pointset P} = n} f\of {n,z}$
\emph{uniformly in $z\in\gW_n$} if
for some $u \of {n,z} \preccurlyeq_n f \of {n,z}$ uniformly in $z\in\gW_n$,\[
\forall n\in \N, \forall z\in\gW_n,
\forall \pointset P \text{ such that } \Cardinality {\pointset P} = n,
g_z \of {\pointset P} \leq u \of {n, z}\text.\]
In both cases $\pointset P$ runs over all point sets that satisfy the relevant properties.
\subsection{A remark on the asymptotics of the binomial coefficient}
Unsurprisingly, binomial coefficients will be involved in the bounds, so we now give a uniform exponential
upper bound for them.
It can be shown by writing the logarithm of the factorial as a sum of logarithms,
and then bounding that sum by integrals, that\[
\forall k\in \Positives, \E \pa{\frac{k}{\E}}^k \leq \Factorial k \leq k \E \pa{\frac{k}{\E}}^k\text.
\]
It follows that\begin{align*}
\forall k\in \Positives, \forall \gh\in\intopen 0 1, \binom{k}{\gh k} &\leq
\frac{k \E \pa{\frac{k}{\E}}^k}{\E \pa{\frac{\gh k}{\E}}^{\gh k} \E \pa{\frac{\pa{1-\gh} k}{\E}}^{\pa{1-\gh}k}}\\
&=\frac{k}{\E} \frac{k^k}{\pa{\gh k}^{\gh k}\pa{\pa{1-\gh} k}^{\pa{1-\gh} k}} \\
&=\frac{k}{\E} \pa{\frac{1}{\gh^\gh\pa{1-\gh}^{1-\gh}}}^k \\
&=\frac{k}{\E} \pa{\frac{\pa{1-\gh}^{\gh-1}}{\gh^\gh}}^k\text,
\end{align*}
so that, since $\forall k\in \N, \binom k 0 = \binom k k = 1$, we have
\begin{equation}
\binom k {\gh k} \preccurlyeq_k \pa{\frac{\pa{1-\gh}^{\gh-1}}{\gh^\gh}}^k \text{ uniformly in $\gh\in\intclos 0 1$.}
\end{equation}
\subsection{Triangulations of convex point sets and the Catalan numbers}
A set of points is said to be \emph{in convex position} if it is in general position and
all points are in the boundary of its convex hull.

For points in convex position, the numbers of triangulations and perfect matchings are known.
The following recurrence, given by J.~A.~Segner in 1758 \cite{Segner1758}, defines the \emph{Catalan numbers}.
\begin{theorem}[Segner]
Let $\CatalanNumber n$ be the number of triangulations of a set of $n+2$ points in convex position.
Then $\CatalanNumber 0 = 1$, and for $n>0$, \begin{equation}
\CatalanNumber n = \sum {i=0}[n-1] \CatalanNumber i \CatalanNumber {n-i-1}\text. \label{CatalanRecurrence}
\end{equation}
\begin{proof}
Consider a set of $n+2$ points in convex position.
For $n=0$ the result is trivial, the only triangulation is an edge.

Let $n > 0$, and number the points along the boundary of the convex hull, from $0$ to $n+1$,
see figure~\ref{figSegnerRecurrence}.
The edge $e$ joining points $n+1$ and $n$ is in the boundary of the convex hull, and thus must
be in any triangulation, since no other edge can cross it. Let $i$ be the index of the third point of the
triangle containing edge $e$, which may be any of the others, from $0$ to $n-1$.

Then, restricting the triangulation to the $i+2$ points $\set{0,\dotsc,i,n+1}$ yields a triangulation
of those points.
Similarly, restricting the triangulation of the whole point set to points $i$ through $n$ yields a triangulation of
$n-i+1$ points. It follows that $\CatalanNumber n \leq \sum {i=0}[n-1] \CatalanNumber i \CatalanNumber {n-i-1}$.

Moreover, given a triangulation of $\set{0,\dotsc,i,n+1}$ and a triangulation of $\set{i,\dotsc, n}$,
adding the edge $e$ forms a triangulation of the whole point set, proving equality.
\end{proof}
\end{theorem}
\marginfig[Segner's recurrence.\label{figSegnerRecurrence}]{
\begin{tikzpicture}[scale=0.5]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\node[dot,label=left:$0$] at (1,1) (p0) {};
\node[dot,label=left:$1$] at (0,2) (p1) {};
\node[dot,label=left:$i-1$] at (0.5,3.5) (piminus1) {};
\node[dot,label=above left:$i$] at (2,4) (pi) {};
\node[dot,label=above:$i+1$] at (4,4) (piplus1) {};
\node[dot,label=right:$n-1$] at (5.5,3) (pnminus1) {};
\node[dot,label=right:$n$] at (5,1) (pn) {};
\node[dot,label=below:$n+1$] at (3,0) (pnplus1) {};
\draw (pnminus1) -- (pn);
\draw (pnplus1) -- (p0) -- (p1);
\draw (pn) -- (pnplus1) node [midway, label=below right:$e$] {};
\draw (piminus1) -- (pi) -- (piplus1);
\draw[dotted] (p1) -- (piminus1);
\draw[dotted] (piplus1) -- (pnminus1);
\draw (pnplus1) -- (pi) -- (pn);
\end{tikzpicture}}
An explicit expression for $\CatalanNumber n$ was given earlier by Euler \cite{Euler1751}, along
with the generating function.
A convenient form is\begin{equation}
\CatalanNumber n = \frac{1}{n+1} \binom {2n} {n}\text,
\end{equation}
yielding asymptotically
\begin{equation}
\CatalanNumber n \sim \frac{4^n}{n^{\frac{3}{2}}\sqrt{\Pi}} \preccurlyeq_n 4^n\text.
\end{equation}

\subsection{Crossing-free perfect matchings}
\label{PerfectMatchingsIntro}
We will call $\PM_{\pointset P}$ the set of perfect matchings on the point set $\pointset P$,
and $\CFPM_{\pointset P}$ the set
of crossing-free perfect matchings on the point set $\pointset P$.

[TODO talk about the number of crossing-free perfect matchings in convex position, give the proof;
find the Alfred Errera thing from the octavo of the académie royale de belgique, reference 10 in
Sharir--Welzl; this might require a trip to the library?]

For a set $\pointset P$ of $n$ points in general position, it was proved by Micha~Sharir and Emo~Welzl in 2005
\cite{SharirWelzl2006} that $\Cardinality{\CFPM_{\pointset P}} \preccurlyeq_n 10.05^n$.

When talking about a perfect matching, we will denote the unique edge incident to point $p$ by
$e_p$.

\subsection{Bracket expressions and their relations to perfect matchings}

We say that a point set is \emph{in general position with respect to the horizontal} if it
is in general position and no two points lie on a vertical line. Note that any point set in
general position can be put in general position with respect to the horizontal by an arbitrarily
small rotation. Moreover, note that points in general position with respect to the horizontal
are ordered from left to right.

This ordering can be used to classify perfect matchings on the point set; to this end,
we introduce bracket expressions.
A \emph{bracket expression} of length $n$ is a sequence of $n$ opening brackets $\langle$ or closing
brackets $\rangle$.
It is a \emph{well-formed prefix} if, when read from left to right, the number of closing brackets
encountered never exceeds the number of opening brackets encountered.
A \emph{well-formed bracket expression} is a well-formed prefix with the same number of opening and
closing brackets.

It is a well-known result, shown\footnote{Specifically, Catalan showed that the recurrence (\ref{CatalanRecurrence})
counts the number of parenthesizings of $n+1$ factors.} by E.~C.~Catalan in 1838 \cite{Catalan1838}, that the
number of well-formed bracket expressions
of length $2k$ is the Catalan number $\CatalanNumber k$. In fact, the recurrence can readily be seen from
a grammatical definition of well-formed bracket expressions,\footnote{We have not enclosed nonterminals
in angle brackets here, as would be usual in Backus--Naur form, since that would result in hopeless
confusion in a grammar describing nothing but sequences of angle brackets.}\begin{align*}
\text{wfbe} \Coloneq
& \langle \text{wfbe} \rangle \text{wfbe} \\
\mid\: & \text{empty}\text,
\end{align*}
where the sum in the recurrence ranges over the lengths of the component bracket expressions.

Note that inserting an opening bracket, followed by a closing bracket anywhere after the
inserted opening bracket, into a well-formed bracket expression, results in a well-formed bracket
expression.

Well-formed bracket expressions can be used to define classes of perfect matchings on a given point set.
Given a point set $\pointset P$  of size $n$ in general position with respect to the horizontal and a perfect
matching $\gm$ on $\pointset P$, any point in $\pointset P$ is either a left or right endpoint of an edge, since it
is incident to exactly one edge, and that edge is not vertical.

\marginfig[A well-formed bracket expression constructed from a perfect matching.]{
\begin{tikzpicture}[scale=0.5]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\node[dot] at (0,2) (p1) {};
\node[dot] at (1,3) (p2) {};
\node[dot] at (2,4) (p3) {};
\node[dot] at (3,0) (p4) {};
\node[dot] at (5,1) (p5) {};
\node[dot] at (6,3) (p6) {};

\node at (0,-1) (b1) {$\langle$};
\node at (1,-1) (b2) {$\langle$};
\node at (2,-1) (b3) {$\rangle$};
\node at (3,-1) (b4) {$\langle$};
\node at (5,-1) (b5) {$\rangle$};
\node at (6,-1) (b6) {$\rangle$};

\draw (p1) -- (p5);
\draw (p2) -- (p3);
\draw (p4) -- (p6);

\draw[dashed] (p1) -- (b1);
\draw[dashed] (p2) -- (b2);
\draw[dashed] (p3) -- (b3);
\draw[dashed] (p4) -- (b4);
\draw[dashed] (p5) -- (b5);
\draw[dashed] (p6) -- (b6);
\end{tikzpicture}}
Construct a bracket expression ${\mathfrak B}_{\pointset P}\of\gm$ of length $n$ as follows: order $\pointset P$ from left
to right;
the $i$th bracket is opening if the $i$th point of $\pointset P$ is a left endpoint of $\gm$, and it is
closing otherwise.
This bracket expression is well-formed, since it can be constructed by starting from the
(well-formed) empty bracket expression, by successively inserting both brackets corresponding to
each edge, where the closing bracket will be inserted to the right of the opening bracket.

Given a well-formed bracket expression $B$ and a point set $\pointset P$, we will say that a perfect matching
$\gm$ is \emph{consistent with} $B$ if ${\mathfrak B}_{\pointset P}\of\gm = B$; moreover, we will refer to the points of
$\pointset P$ corresponding to opening brackets of $B$ as \emph{left-points} (since they will be left endpoints
of any perfect matching consistent with $B$), and similarly we will refer to the points of $\pointset P$
corresponding to closing brackets of $B$ as \emph{right-points}.

One approach to bounding the size of $\CFPM_{\pointset P}$ is to bound the size of
${\mathfrak B}_{\pointset P}^{-1}\of{B}\Intersection \CFPM_{\pointset P}$ for bracket expressions $B$ of length $n$\idest the
number of crossing-free perfect matchings on $\pointset P$ consistent with $B$. We thus define
\[\gn_{\pointset P}\of B \DefineAs
\Cardinality{{\mathfrak B}_{\pointset P}^{-1}\of{B}\Intersection \CFPM_{\pointset P}}\text.\]
In order to concisely refer to bracket expressions, we will use the notations
$\langle^k$ for $k$ successive opening brackets, and $\rangle^k$ for $k$ successive
closing brackets, for instance,\[
\langle^2\rangle\langle^2\rangle^3 = \langle\langle\rangle\langle\langle\rangle\rangle\rangle
\text.\]

[TODO a section or subsection or something here, talking about the trivial upper bounds on $\langle\rangle$,
and about the bound on a product of bracket expressions. Maybe about the boring stuff like
$\langle\langle\rangle E \rangle$, but frankly that's not very interesting]

[TODO cite the existing upper bound from Sharir--Welzl 2006 (the proof is unrelated to anything here
though)]
\label{boundOnLeftRightPerfectMatchings}
\subsection{An optimal lower bound for the number of crossing-free perfect matchings}
The following proof is due to A.~J.~Ruiz-Vargas and E.~Welzl \cite{RuizVargasWelzl2016}.
\begin{theorem}[Ruiz-Vargas--Welzl]
Let $\pointset P$ be a point set of size $n = 2k$ in general position with respect to the horizontal,
and let $B$ be a well-formed bracket expression of length $n$.
Then there exists a crossing-free perfect matching consistent with $B$; in other words,
$\gn_{\pointset P}\of B \geq 1$.
\end{theorem}
\begin{proof}
Let $\gm_0$ be a perfect matching on $\pointset P$ consistent with $B$. This is always possible, for instance,
parsing the bracket expression, match the point corresponding to an opening bracket
and the point corresponding to the matching closing bracket.

Define $\gL\of\gm$ for a perfect matching $\gm$ on $\pointset P$ to be the sum of the lengths of the edges of $\gm$.

\marginfig[\label{figUncrossing}Untangling in a perfect matching. Replacing the thick
edges by the thin ones reduces the total edge length, while preserving left and right endpoints.]{
\begin{tikzpicture}[scale=1]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\node[dot,label=below:$v$] at (0,0) (a) {};
\node[dot,label=above:$v'$] at (-0.5,1) (c) {};
\node[dot,label=below:$w'$] at (2,0.5) (d) {};
\node[dot,label=above:$w$] at (1.5,1.5) (b) {};

\draw (a) -- (d);
\draw (c) -- (b);
\draw[very thick] (a) -- (b);
\draw[very thick] (c) -- (d);
\end{tikzpicture}}
Then, repeat the following procedure, starting at $i=0$.
If there is no crossing in $\gm_i$, we have found a perfect matching with the desired properties.
If there is a crossing, let $v$, $v'$, $w$, and $w'$ be the points involved, with $v$ and $v'$ being the left
endpoints and $w$ and $w'$ being the right endpoints, so that the edge
$vw$ crosses the edge $v'w'$. Remove these edges, and replace them by $vw'$ and $v'w$
(thus untangling them). This yields another perfect matching $\gm_{i+1}$. By the triangle
inequality (see figure \ref{figUncrossing}), $\gL\of{\gm_{i+1}}<\gL\of{\gm_i}$.

If this procedure did not terminate, it would yield a sequence $\tuple{\gm_i}_{i\in\N}$ of crossing
perfect matchings on $\pointset P$ on which $\gL$ is strictly decreasing, thus an infinite sequence of distinct
graphs on $\pointset P$.
Since there are only finitely many graphs on $\pointset P$, this is a contradiction, so we
eventually\footnote{The untangling procedure itself predates this proof, and was shown to terminate in
$\BigO\of{n^3}$ steps by J.~van~Leeuwen and A.~A.~Schoone in 1980 \cite{LeeuwenSchoone1981}.}
find a
crossing-free perfect matching.
\end{proof}
This immediately yields a lower bound for the number of crossing-free perfect matchings, since
there are $\CatalanNumber {\frac n 2}$ well-formed bracket expressions of length $n$.
Note that this lower bound had already been proved by A.~García, M.~Noy, and J.~Tejel in 1995,
by a recurrence that split the point set, rather than via well-formed bracket expressions
\cite{GarciaNoyTejel2000}.
\begin{corollary}
Let $\pointset P$ be a point set of even size $n$ in general position. There are at least $\CatalanNumber {\frac n 2}$ distinct
crossing-free perfect matchings on $\pointset P$\idest $\Cardinality{\CFPM_{\pointset P}} \geq \CatalanNumber {\frac n 2}$.
\end{corollary}
Moreover, this lower bound is optimal, since it is attained if $\pointset P$ is in convex position (see
section~\ref{PerfectMatchingsIntro}).

Now that we have a tight uniform lower bound for $\gn_{\pointset P}$, we will start looking at upper bounds
dependent on the bracket expression.
\subsection{Matchings across a line}
Again we consider $n=2k$ points in general position with respect to the horizontal.
The matchings consistent with bracket expressions with $k$ opening brackets followed
by $k$ closing brackets, $\langle^k\rangle^k$, are called \emph{matchings
across a line}. Indeed, any edge in such a matching will cross any vertical line that separates
the left-points from the right-points.

The following result, and its proof, were given by Micha Sharir and Emo Welzl in 2005 \cite{SharirWelzl2006}.
\NoEndMark
\begin{theorem}[Sharir--Welzl]
Let $\pointset P$ be a set of $n=2k$ points in general position with respect to the horizontal.
Then there are at most $\CatalanNumber {\frac n 2}^2$ crossing-free perfect matchings across a line on $\pointset P$\idest
$\gn_{\pointset P}\of {\langle^k\rangle^k} \leq \CatalanNumber k^2$.
\end{theorem}
The idea of the proof is as follows.
First, pick a vertical line that separates the left-points from the right-points;
we will call it \emph{the vertical line}.
Further, let us call the set of left-points $\pointset L$ and the set of right-points $\pointset R$.

A perfect matching consistent with a given well-formed bracket expression (and in particular, a perfect
matching across a line) is uniquely defined by a bijection $\FunctionSpec \gm {pointset L} {\pointset R}$ from
the left-points to the right-points. Consider such a perfect
matching across a line, and let $E$ be the set of its edges.
Now, number the intersections between the edges of the perfect matching and the vertical
line from top to bottom. This yield a numbering $\FunctionSpec \gi E {[k]}$ of the edges.
\marginfig[Constructing the numberings $\gl$ and $\gr$ of the left- and right-points from
a crossing-free perfect matching across a line; here $\gi\of{\set{p,q}} = 2$, and thus
$\gl\of{p}=\gr\of q = 2$.\label{figConstructCFA}]{
\begin{tikzpicture}[scale=0.75]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\node[dot] at (-3,1.5) (l1) {};
\node[dot] at (-2,2) (l2) {};
\node[dot,label=below left:$p$] at (-0.5,3) (l3) {};
\node[dot,label=below right:$q$] at (0.5,3) (r1) {};
\node[dot] at (1,4.5) (r2) {};
\node[dot] at (2,0) (r3) {};

\node at (-3,-1) {$\langle$};
\node at (-2,-1) {$\langle$};
\node at (-0.5,-1) {$\langle$};
\node at (0.5,-1) {$\rangle$};
\node at (1,-1) {$\rangle$};
\node at (2,-1) {$\rangle$};

\node[inner sep=0pt,label=above left:$1$] at (0,3.75) {};
\node[inner sep=0pt,label=above right:$2$] at (0,3) {};
\node[inner sep=0pt,label=above right:$3$] at (0,1) {};

\draw (l1) -- (r2);
\draw (l2) -- (r3);
\draw (l3) -- (r1);

\draw[very thick] (0,5) -- (0,0);
\end{tikzpicture}}

Define $\gl\of l \DefineAs \gi\of{e_l}$ mapping a left-point to the intersection number of its
edge, and similarly $\gr\of r \DefineAs \gi\of{e_r}$ for the right-points. We have
$\gm = \gr^{-1} \Compose \gl$.

The bijection $\gl$ (respectively $\gr$) determines the order in which the left points (respectively right points)
reach the vertical line.

If the matching is crossing-free, we will show that
$\gl$ and $\gr$ have to be in sets of size $\CatalanNumber k$, thus that there are at most $\CatalanNumber k^2$ functions
$\gm = \gr^{-1} \Compose \gl$\idest that there can be at most $\CatalanNumber k^2$ crossing-free perfect matchings across a line.

Since we are going to reuse these concepts in subsequent sections, we will formalize and name the properties of
$\gl$ and $\gr$ that we will consider.
\begin{definition}[crossing-free alignment]
Let ${\pointset S}$ be a set of $k$ points in general position. Let $V$ be a vertical line to the right of ${\pointset S}$.
A bijection $\gl$ from ${\pointset S}$ to $[k]$ is a \emph{crossing-free left-alignment of ${\pointset S}$ on $V$} if
there exists a set $A=\setst{\gs_p}{p\in{\pointset S}}$ of $k$ line segments such that
the following hold:
\begin{enumerate}
\item for every $p\in{\pointset S}$, the left endpoint of $\gs_p$ is $p$, and its right endpoint is on $V$;
\item no two segments cross, and no two segments share any endpoints;
\item let $\FunctionSpec \gi A {[k]}$ the numbering of the right endpoints of the segments in
$A$ from top to bottom, then $\gl\of p = \gi\of{\gs_p}$.
\end{enumerate}
Such a set of segments is said to \emph{realize} $\gl$.

Correspondingly, we define a \emph{crossing-free right-alignment}, where ``right'' and ``left'' are swapped in the
definition.
\end{definition}
A crossing-free left-alignment of five points, with a realizing set of segments---drawn as arrows---is shown in
figure~\ref{figCrossingFreeAlignment}.

\marginfig[A crossing-free left-alignment of five points. Once the index of the leftmost point is chosen (thick segment),
the rest consists of two crossing-free left-alignments of $i$ and $k-i-1$
points each---here $k = 5$ and $i = 2$.\label{figCrossingFreeAlignment}]{
\begin{tikzpicture}[scale=0.75]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\node[dot] at (-5,2) (p1) {};
\node[dot] at (-4,1) (p2) {};
\node[dot] at (-3,4) (p3) {};
\node[dot] at (-2,1.5) (p4) {};
\node[dot] at (-1,3.5) (p5) {};

\node[inner sep=0pt,label=right:$1$] at (0,4) (l1) {};
\node[inner sep=0pt,label=right:$2$] at (0,3) (l2) {};
\node[inner sep=0pt,label=right:$3$] at (0,2.5) (l3) {};
\node[inner sep=0pt,label=right:$4$] at (0,1.5) (l4) {};
\node[inner sep=0pt,label=right:$5$] at (0,1) (l5) {};

\draw[->,very thick] (p1) -- (l3);
\draw[->] (p3) -- (l2);
\draw[->] (p5) -- (l1);
\draw[->] (p4) -- (l4);
\draw[->] (p2) -- (l5);

\draw[very thick] (0,5) -- (0,0);
\end{tikzpicture}}
\begin{lemma}
Let ${\pointset S}$ be a set of $k$ points in general position, and let $V$ be a vertical line to the right of ${\pointset S}$.
There are at most $\CatalanNumber k$ crossing-free left-alignments of ${\pointset S}$ on $V$.
\begin{proof}
Let $l$ be the leftmost point of ${\pointset S}$, and let $\gl$ be a crossing-free left-alignment of ${\pointset S}$ on $V$.
Let $A=\setst{\gs_p}{p\in{\pointset S}}$ be a set of non-crossing line segments realizing $\gl$.
For a point $p\in{\pointset S}$, we will call $\gs_p$ \emph{the segment of $p$}.

$\gl(l)$, being the index on the vertical line $V$ of the right endpoint of the segment $\gs_l$ of the leftmost point,
is equal to one plus the number of points of ${\pointset S}$ that are above $\gs_l$. Indeed, the segments of points above
$\gs_l$ must
themselves reach the vertical line $V$ above $\gs_l$, otherwise they would cross $\gs_l$, and correspondingly for
points below $\gs_l$, so that there are as many edges reaching the vertical line $V$ below $\gs_l$ as there are points
below $\gs_l$.

Moreover, as the oriented angle between $\gs_l$ and the horizontal increases, points are only added to the
set of points below $\gs_l$, so that choosing the number of points below $\gs_l$ determines the sets of points
below and above $\gs_l$.

Further, since points above $\gs_l$ must reach the vertical line $V$ above $\gs_l$, and correspondingly for points below,
if the point $p$ is above $\gs_l$, then $\gl(p) < \gl(l)$, and if it is below, $\gl(p) > \gl(l)$. Thus
$\gl$ restricted do the points above $\gs_l$ is a crossing-free left-alignment of the $\gl(l) - 1$ points above
$\gs_l$, and $\gl-\gl(l)$ restricted to the points below $\gs_l$ is a crossing-free left-alignment of the
$k - \gl(l)$ points below $\gs_l$, where the appropriate subsets of $A$ provide the set of segments required
in the definition.

It follows that $\gl$ is determined by the choice of $\gl\of l$ and crossing-free left-align\-ments
of $\gl\of{l}-1$ and $k-\gl\of{l}$ points.
Letting $i\DefineAs \gl\of l - 1$, these are crossing-free alignments of $i$ and $k-i-1$ points (see
figure~\ref{figCrossingFreeAlignment}).
Therefore, if $\gcp_j$ is an upper bound for the number of crossing-free
left-alignments of $j$ points when $j < k$,
we can give an upper bound on the number of crossing-free left-alignments of $k$ points,
\[\gcp_k\DefineAs\sum{i=0}[k-1]\gcp_{i}\gcp_{k-i-1}\text.\]
We can start the recurrence with $\gcp_0 = 1$; this is the recurrence for the Catalan numbers, thus
$\gcp_k=\CatalanNumber k$.
\end{proof}
\end{lemma}
The same results holds for crossing-free right-alignments, simply exchange ``left'' and ``right'' in the above
lemma and its proof.

\begin{proof}[of the theorem]
If we have a crossing-free perfect matching across a line, then $\gl$ as constructed above is a crossing-free
left-alignment of $\pointset L$ on the vertical line; indeed, letting $\gs_p$ be the portion of the edge $e_p$
to the left of the vertical line yields segments that realize $\gl$.
Similarly, $\gr$ is a crossing-free right-alignment of $\pointset R$ on the vertical line.
\end{proof}
\section{Analysing the overcounting in the upper bound for matchings across a line}
\label{sectionOvercounting}
The bound given above for the number of matchings across a line is not optimal;
an example is given by Sharir and Welzl of a crossing-free left-alignment $\gl$ and a crossing-free
right-alignment $\gr$ such that $\gr^{-1}\Compose \gl$ is not crossing-free (see figure~\ref{crossingPMAL}).
\marginfig[Composing crossing-free alignments, only to get a crossing perfect
matching.\label{crossingPMAL}]{TODO}

There is however more to the overcounting than just counting some crossing matchings.
To characterize that, it helps to name some functions and sets. Again, are considering a
set $\pointset P$ of $2k$ points in general position with respect to the horizontal and the bracket
expression $\langle^k\rangle^k$.  We let $\pointset L$ be the set of left-points, and $\pointset R$ be the
set of right-points. Moreover, we pick a vertical line separating $\pointset L$ and $\pointset R$, and call it
$V$.

In the previous section, given a crossing-free perfect matching $\gm$, we constructed crossing-free
left- and right-alignments $\gl$ and $\gr$ (see figure~\ref{figConstructCFA}). Let us call that
construction $\gw$, thus $\gw\of{\gm}=\tuple{\gl, \gr}$. Moreover, let us call $\CFLA_{\pointset L, V}$ the
set of crossing-free left-alignments of $\pointset L$ on $V$, and $\CFLA_{\pointset R, V}$ the set of crossing-free
left-alignments of $\pointset R$ on $V$. Given sets of equal sizes $\pointset L$ and $\pointset R$,
$\gl\in\CFLA_{\pointset L, V}$, and $\gr\in\CFRA_{\pointset R, V}$,
let $c\of{\gl,\gr}$ be the (possibly crossing) perfect matching $\gr^{-1}\Compose\gl$.
Finally, let us name the sets of perfect matchings across a line and of
crossing-free perfect matchings across a line,
\begin{align*}
\PMAL_{\pointset P} &\DefineAs {\mathfrak B}_{\pointset P}^{-1}\of{\langle^k\rangle^k}\\
\CFPMAL_{\pointset P} &\DefineAs \PMAL_{\pointset P} \Intersection \CFPM_{\pointset P}\text.
\end{align*}
Then the following diagram commutes\idest constructing crossing-free alignments from a matching
and then composing them yields the initial matching.
\[\begin{tikzcd}
\CFPMAL_{\pointset P} \arrow{r}{\gw} \arrow[hook]{d}{\Subset} &
\CFLA_{\pointset L, V}\Cartesian\CFRA_{\pointset R, V} \arrow{ld}{c} \\
\PMAL_{\pointset P}
\end{tikzcd}\]
The result of Sharir and Welzl consists in deducing from the commutative diagram that
$\gw$ must be injective, and so that\begin{equation}
\Cardinality{\CFPMAL_{\pointset P}} \leq
\Cardinality{\CFLA_{\pointset L, V}\Cartesian\CFRA_{\pointset R, V}}\text, \label{SharirWelzlOvercounting}
\end{equation}
and then a bound for the number of crossing-free alignments yields a bound for the number of
crossing-free matchings across a line.

\marginfig[Composing crossing-free alignments, and getting a crossing-free perfect matching,
but one that does not decompose to the original alignments.\label{figWeirdAligments}]{TODO}
The inequality (\ref{SharirWelzlOvercounting}) is strict, as shown in figure~\ref{crossingPMAL}.
We would thus like to study the pairs of crossing-free alignments which are \emph{not} in
the image of $\gw$, since they are responsible for that excess; we will call them \emph{overcounted}.
Overcounted pairs of crossing-free alignments fall into one of two categories;
\begin{enumerate}
\item
evidently, if $c\of{\gl,\gr}$ is crossing, then $\tuple{\gl,\gr}$ is not in the image of $\gw$,
since the diagram commutes;
\item on the other hand, figure~\ref{figWeirdAligments} shows a pair of
crossing-free alignments $\tuple{\gl,\gr}$ which composes to a crossing-free alignment
$\gm = c\of{\gl,\gr}$, but which is not equal to $\gw\of\gm$.
\end{enumerate}
In addition, we will call a crossing-free left alignment $\gl$ overcounted if any pair
$\tuple{\gl, \gr}$ is overcounted.
\marginfig[A set $\pointset L$ of five points. The half-plane to the right
of the leftmost point $\leftmost \pointset L$ is partitioned in
$\Cardinality{\pointset L}$ cones $\lcone i$.\label{figCones}]{
\begin{tikzpicture}[scale=0.75]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\shade[shading=axis,
       left color=gray,
       right color=white] (-5,0) rectangle (0,5);
       
\node[dot, label=left:$\leftmost \pointset L$] at (-5,2) (lm) {};
\node[dot] at (-4,1) (p2) {};
\node[dot] at (-3,4) (p3) {};
\node[dot] at (-2,1.5) (p4) {};
\node[dot] at (-1,3.5) (p5) {};

\node at (-4.5,0.5) {$\lcone 5$};
\node at (-2.5,1) {$\lcone 4$};
\node at (-1.5,2.5) {$\lcone 3$};
\node at (-2,4) {$\lcone 2$};
\node at (-4,4) {$\lcone 1$};

\draw (-5,5) -- (-5,0);

\begin{scope}
\clip (-5,0) rectangle (0,5);
\draw (lm) -- ($(lm)!10cm!(p2)$);
\draw (lm) -- ($(lm)!10cm!(p3)$);
\draw (lm) -- ($(lm)!10cm!(p4)$);
\draw (lm) -- ($(lm)!10cm!(p5)$);
\end{scope}
\end{tikzpicture}}

To hunt down overcounted crossing-free alignments, we will examine in more detail the anatomy of a crossing-free
left-aligment of $\pointset L$ and the proof of the Sharir--Welzl bound for the number of crossing-free left-alignments,
with some fresh definitions.

First, for a point set $\pointset L$, note that we can partition the half-plane to the right of $\leftmost\of L$ in
$\Cardinality L$ regions,
separated by rays emanating from $\leftmost\of L$ and going through other points of $\pointset L$. We will call those regions
\emph{left $\pointset L$-cones}, and number them from top to bottom from $1$ to $\Cardinality L$, see figure~\ref{figCones}.
Note that there are $i$ points of $\pointset L$ above the interior of left $\pointset L$-cone
number $i+1$, and $\Cardinality L - i - 1$ points below.

Given a crossing-free left-alignment $\gl$ of $\pointset L$ on $V$, for any set of segments $A=\setst{\gs_p}{p\in L}$
realizing $\gl$, the segment $\gs_{\leftmost\of L}$ of the leftmost point then has to be contained in left
$\pointset L$-cone number $\gl\of{\leftmost\of L}$.
As we remarked in the previous section, for a crossing-free perfect matching $\gm$, the edges of $\gm$ restricted
to the left side of $V$ realize the left-alignment in $\gw\of\gm$. Thus if $\tuple{\gl, \gr}$ is in the image of
$\gw$, $\leftmost\of L$ has to be matched to a right-point in left $\pointset L$-cone number $\gl\of{\leftmost\of L}$, see
figure~\ref{figConesNeedPoints}.

\marginfig[A left conifer on five points; the cone associated with each point is drawn in
the same colour as that point.\label{figLeftConifer}]{
\begin{tikzpicture}[scale=0.75]
\tikzstyle{dot}=[draw,shape=circle,scale=0.5]
       
\node[dot,fill=red] at (-5,2) (lm) {};
\node[dot,fill=green] at (-4,1) (p2) {};
\node[dot,fill=blue] at (-3,4) (p3) {};
\node[dot,fill=cyan] at (-2,1.5) (p4) {};
\node[dot,fill=black] at (-1,3.5) (p5) {};

\begin{scope}[on background layer]
\begin{scope}
\clip ($(lm)!10cm!(p5)$) -- (lm.center) -- ($(lm)!10cm!(p4)$) -- cycle;
\shade[shading=axis,
       left color=red,
       nearly transparent] (-5,0) rectangle (0,5);
\end{scope}
\begin{scope}
\clip ($(p2)!10cm!(p4)$) -- (p2.center) -- (-4,0) -- (0,0) -- cycle;
\shade[shading=axis,
       left color=green,
       nearly transparent] (-4,0) rectangle (0,5);
\end{scope}
\begin{scope}
\clip ($(p3)!10cm!(p5)$) -- (p3.center) -- (-3,0) -- (0,0) -- cycle;
\shade[shading=axis,
       left color=blue,
       nearly transparent] (-3,0) rectangle (0,5);
\end{scope}
\shade[shading=axis,
       left color=cyan,
       nearly transparent] (-2,0) rectangle (0,5);
\shade[shading=axis,
       left color=black,
       nearly transparent] (-1,0) rectangle (0,5);
\end{scope}
\end{tikzpicture}}
To extend this reasoning beyond the leftmost point of $\pointset L$, we define \emph{left conifers of $\pointset L$}.
A left conifer $\gk$ of a point set $\pointset L$ is a map from points in $\pointset L$ to left $S$-cones for subsets $S$
of $\pointset L$,
satisfying the following properties:
\begin{enumerate}
\item $\gk\of{\leftmost\of L}$ is a left $\pointset L$-cone;
\item $\gk$ restricted to the points above the interior of $\gk\of{\leftmost\of L}$ is a left conifer of these points;
\item $\gk$ restricted to the points below the interior of $\gk\of{\leftmost\of L}$ is a left conifer of these points.
\end{enumerate}
\marginfig[A crossing-free left-alignment $\gl$ (the one from figure~\ref{figCrossingFreeAlignment}),
together with the conifer $\conification_\gl$.\label{figConification}]{
\begin{tikzpicture}[scale=0.75]
\tikzstyle{dot}=[draw,shape=circle,scale=0.5]
       
\node[dot,fill=red] at (-5,2) (lm) {};
\node[dot,fill=green] at (-4,1) (p2) {};
\node[dot,fill=blue] at (-3,4) (p3) {};
\node[dot,fill=cyan] at (-2,1.5) (p4) {};
\node[dot,fill=black] at (-1,3.5) (p5) {};

\node[inner sep=0pt,label=right:$1$] at (0,4) (l1) {};
\node[inner sep=0pt,label=right:$2$] at (0,3) (l2) {};
\node[inner sep=0pt,label=right:$3$] at (0,2.5) (l3) {};
\node[inner sep=0pt,label=right:$4$] at (0,1.5) (l4) {};
\node[inner sep=0pt,label=right:$5$] at (0,1) (l5) {};

\draw[->] (lm) -- (l3);
\draw[->] (p3) -- (l2);
\draw[->] (p5) -- (l1);
\draw[->] (p4) -- (l4);
\draw[->] (p2) -- (l5);

\begin{scope}[on background layer]
\begin{scope}
\clip ($(lm)!10cm!(p5)$) -- (lm.center) -- ($(lm)!10cm!(p4)$) -- cycle;
\shade[shading=axis,
       left color=red,
       nearly transparent] (-5,0) rectangle (1,5);
\end{scope}
\begin{scope}
\clip ($(p2)!10cm!(p4)$) -- (p2.center) -- (-4,0) -- (1,0) -- cycle;
\shade[shading=axis,
       left color=green,
       nearly transparent] (-4,0) rectangle (1,5);
\end{scope}
\begin{scope}
\clip ($(p3)!10cm!(p5)$) -- (p3.center) -- (-3,0) -- (1,0) -- cycle;
\shade[shading=axis,
       left color=blue,
       nearly transparent] (-3,0) rectangle (1,5);
\end{scope}
\shade[shading=axis,
       left color=cyan,
       nearly transparent] (-2,0) rectangle (1,5);
\shade[shading=axis,
       left color=black,
       nearly transparent] (-1,0) rectangle (1,5);
\end{scope}
\draw[very thick] (0,5) -- (0,0);
\end{tikzpicture}}
See figure~\ref{figLeftConifer} for an example.
We call $\LC L$ the set of left conifers of $\pointset L$. From the observations above on the number
of cones and the
size of the sets of points above and below their interiors, if $\gcp_k$ is the number of left conifers of $k$ points,
we have
\[
\gcp_k=\sum{i=0}[k-1]\gcp_{i}\gcp_{k-i-1} \text{ and } \gcp_0=1\text,
\]
so that $\Cardinality{\LC L} = \CatalanNumber {\Cardinality L}$.

\marginfig[It is impossible to construct a vertical line $V$ to the right of these four points and a
crossing-free left-alignment $\gl$ of these points on $V$ such that $\conification_\gl$ is the conifer
shown. Indeed, realizing segments $\gs_p$ and $\gs_q$ would have to lie within
the red and green cones respectively, and thus they would cross, a contradiction.\label{figCrossingConifer}]{
\begin{tikzpicture}[scale=0.75]
\tikzstyle{dot}=[draw,shape=circle,scale=0.5]
       
\node[dot,fill=red,label=above:$p$] at (-4,2) (lm) {};
\node[dot,fill=green,label=above:$q$] at (-3,4) (p2) {};
\node[dot,fill=blue] at (-2,2) (p4) {};
\node[dot,fill=black] at (-1,1) (p5) {};
\clip (-5,0) rectangle (0,5);

\begin{scope}[on background layer]
\begin{scope}
\clip ($(lm)!10cm!(p5)$) -- (lm.center) -- ($(lm)!10cm!(p4)$) -- cycle;
\shade[shading=axis,
       left color=red,
       nearly transparent] (-4,0) rectangle (0,5);
\end{scope}
\begin{scope}
\clip ($(p2)!10cm!(p4)$) -- (p2.center) -- (-3,0) -- (0,0) -- cycle;
\shade[shading=axis,
       left color=green,
       nearly transparent] (-4,0) rectangle (0,5);
\end{scope}
\shade[shading=axis,
       left color=blue,
       nearly transparent] (-2,0) rectangle (0,5);
\shade[shading=axis,
       left color=black,
       nearly transparent] (-1,0) rectangle (0,5);
\end{scope}
\end{tikzpicture}}
Recall that a crossing-free left-alignment $\gl$ is determined by the value of $\gl\of{\leftmost\of L}$ and by
crossing-free left alignments
of the points above and below any edge realizing $\gl$\idest above and below cone number $\gl\of{\leftmost\of L}$.
This is equivalent to choosing left $\pointset L$-cone number $\gl\of{\leftmost\of L}$,
and recursively doing so in the point subsets above and below the
interior of that cone, see figure~\ref{figConification}.
This gives an injective map $\FunctionNamedBody\conification\gl{\conification_\gl}$
from crossing-free left-alignments of $\pointset L$ on any line to left conifers. 
Note that it is not bijective, see figure~\ref{figCrossingConifer}.
In turn, this yields $\Cardinality{\CFLA_{\pointset L, V}}\leq\Cardinality{\LC L}=
\CatalanNumber {\Cardinality L}$, which is exactly the
Sharir--Welzl bound.

Now, note that
the map $\conification$ has the property that for any set of segments $A=\setst{\gs_p}{p\in L}$ realizing $\gl$,
$\gs_p$ lies inside the cone $\conification_\gl\of{p}$; since the edges of a matching $\gm$ realize the crossing-free
alignments $\gw\of{\gm}$, $\conification_\gl\of{p}$ must contain the right-point to which $p$ is matched.
\section{Highly convex matchings across a line}
\label{sectionHighlyConvex}
In particular, this means that if there is no right-point in $\conification_\gl\of{p}$,
then $\gl$ is overcounted.
We will call \emph{vacuous} a left cone that does not contain any right-points,
and we will call vacuous a left conifer that has vacuous cones; thus $\gl$ is overcounted
if $\conification_\gl$ is vacuous.

We will now use convexity considerations to give an upper bound on the number of non-vacuous left conifers.
Let us first define some concepts related to convex hulls.
Given a set of points $\pointset P$ in general position, the \emph{extreme points of $\pointset P$} are the points of
$\pointset P$ that
are in the boundary of the convex hull of $\pointset P$.
Given a set of points $\pointset L$ in general position with respect to the horizontal and a set of points $\pointset R$
in general position with respect to the horizontal to the right of $\pointset L$,
the \emph{$\pointset R$-liminary points of $\pointset L$} are the points of $\pointset L$ which are extreme points
of $L\Union R$,
see figure~\ref{figLiminaryPoints}.
We will call $\leftmost\of L$ the leftmost point of $\pointset L$; note that it is an $\pointset R$-liminary point
of $\pointset L$.

Note that in polar order around $\leftmost\of L$, the $\pointset R$-liminary points of $\pointset L$ other than
$\leftmost\of L$ are separated by
$\pointset R$, that is, in polar order, one subset of the $\pointset R$-liminary points of $\pointset L$ appears
first, followed by
all points of $\pointset R$, followed by the rest of the $\pointset R$-liminary points of $\pointset L$ (except
$\leftmost\of L$).
We will call those $\pointset R$-liminary points of $\pointset L$ which appear below $\pointset R$ the \emph{lower
$\pointset R$-liminary points of $\pointset L$},
and those that appear above $\pointset R$ the \emph{upper $\pointset R$-liminary points of $\pointset L$}.

If there are $\gd_1$ upper $\pointset R$-liminary points of $\pointset L$, then the first $\gd_1$ left
$\pointset L$-cones are vacuous.
Similarly, if there are $\gd_2$ lower $\pointset R$-liminary points of $\pointset L$, then the last
$\gd_2$ left $\pointset L$-cones are vacuous. Moreover, for any non-vacuous left $\pointset L$-cone
$\mathscr{k}$, any upper $\pointset R$-liminary points
of $\pointset L$ are $\pointset R$-liminary points of the
subset of $\pointset L$ above $\mathscr{k}$, and any lower $\pointset R$-liminary points of $\pointset L$ are
$\pointset R$-liminary points of the
subset of $\pointset L$ below $\mathscr{k}$, so that we get the recurrence
\[\gcp_{k,\gd}\DefineAs\max_{\gd_1+\gd_2=\gd-1}\sum{i=\gd_1}[k-\gd_2-1]\gcp_{i,\gd_1}\gcp_{k-i-1,\gd_2}\text,\]
where $\gcp_{k,\gd}$ is an upper bound on the number of crossing-free non-vacuous left conifers of $k$ points
of which at least $\gd$ are $\pointset R$-liminary.
Moreover, we can start that recurrence with
\begin{align*}
\gcp_{k,0}&\DefineAs\gcp_{k,1}\text,\\
\gcp_{k,k}&\DefineAs1\text,
\end{align*}
since there is at least one $\pointset R$-liminary point of $\pointset L$ (the leftmost one), and if all points are
$\pointset R$-liminary,
only one cone is non-vacuous.
\section{Three changes of bracket direction}
\label{sectionThreeChanges}
We now consider perfect matchings consistent with bracket expressions which have three
changes of bracket directions\idest bracket expressions of the form
$\langle^a\rangle^b\langle^c\rangle^d$,
$a$ opening brackets, $b$ closing brackets, $c$ opening brackets, $d$ closing brackets, where
$a-b=d-c\geq 0$ and $a+b+c+d\DefinitionOf n$.

In term of points, this means that four sets can be separated by vertical lines, from left
to right, $a$ left-points forming the set $\pointset A$, $b$ right-points forming $\pointset B$,
$d$ left-points
forming $\pointset D$, and $c$ right-points forming $\pointset C$.
We pick a vertical line separating $\pointset A$ and $\pointset B$ and call it $V$, and we pick
a vertical line separating $\pointset C$ and $\pointset D$ and call it $W$,
see figure~\ref{figCFPMklqp}.

Given a crossing-free perfect matching on those points, numbering from top to bottom the
intersections between $V$ and edges incident to the points in $\pointset A$,
we get a crossing-free left-alignment $\ga$ of $\pointset A$ on $V$. $a-b$ of the $a$ edges
intersecting $V$
are incident to points in $\pointset D$; the other $b$ are incident to points in $\pointset B$.
Numbering those $b$ edges yields a crossing-free right-alignment $\gb$ of $\pointset B$ on $V$.

Similarly on the right side, we get a crossing-free right-alignment of $\gd$ of $\pointset D$ on $W$,
and numbering the subset of edges joining $\pointset C$ and $\pointset D$, we get a
left-alignment $\gg$ of $\pointset C$ on $W$.
\begin{figure}[!ht]
\centering
\begin{tikzpicture}[scale=0.5]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.25]
\node[dot] at (-9,1.9) (k1) {};
\node[dot] at (-8,1) (k2) {};
\node[dot] at (-7,4) (k3) {};
\node[dot] at (-6,3) (k4) {};
\node[dot] at (-5,0) (k5) {};

\node[dot] at (-3.5,1.5) (l1) {};
\node[dot] at (-2.5,0.5) (l2) {};
\node[dot] at (-1.5,2.5) (l3) {};
\node[dot] at (-0.5,3) (l4) {};

\node[dot] at (0.5,3.7) (p1) {};
\node[dot] at (1.5,0) (p2) {};
\node[dot] at (2.5,1) (p3) {};
\node[dot] at (3.5,2.8) (p4) {};

\node[dot] at (5,2.5) (q1) {};
\node[dot] at (6,0.5) (q2) {};
\node[dot] at (7,3.5) (q3) {};
\node[dot] at (8,1.5) (q4) {};
\node[dot] at (9,2.1) (q5) {};

\draw[very thick, name path=left line] (-4.25,5) -- (-4.25,-1);
\draw[very thick, name path=right line] (4.25,5) -- (4.25,-1);

\draw[gray, name path=edge] (k1) -- (q5);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (k1) -- (align);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (q5) -- (align);


\draw[gray, name path=edge] (k3) -- (l4);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (k3) -- (align);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (l4) -- (align);

\draw[gray, name path=edge] (k2) -- (l1);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (k2) -- (align);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (l1) -- (align);

\draw[gray, name path=edge] (k4) -- (l3);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (k4) -- (align);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (l3) -- (align);

\draw[gray, name path=edge] (k5) -- (l2);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (k5) -- (align);
\draw[->,thick,name intersections={of=edge and left line, by=align}] (l2) -- (align);


\draw[gray, name path=edge] (q1) -- (p4);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (q1) -- (align);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (p4) -- (align);

\draw[gray, name path=edge] (q2) -- (p2);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (q2) -- (align);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (p2) -- (align);

\draw[gray, name path=edge] (q3) -- (p1);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (q3) -- (align);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (p1) -- (align);

\draw[gray, name path=edge] (q4) -- (p3);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (q4) -- (align);
\draw[->,thick,name intersections={of=edge and right line, by=align}] (p3) -- (align);

\node at (-9,-1) {$\langle$};
\node at (-8,-1) {$\langle$};
\node at (-7,-1) {$\langle$};
\node at (-6,-1) {$\langle$};
\node at (-5,-1) {$\langle$};

\node at (-7,5) {$\pointset A$};

\node at (-3.5,-1) {$\rangle$};
\node at (-2.5,-1) {$\rangle$};
\node at (-1.5,-1) {$\rangle$};
\node at (-0.5,-1) {$\rangle$};

\node at (-2,5) {$\pointset B$};
\node at (2,5) {$\pointset C$};

\node at (0.5,-1) {$\langle$};
\node at (1.5,-1) {$\langle$};
\node at (2.5,-1) {$\langle$};
\node at (3.5,-1) {$\langle$};

\node at (7,5) {$\pointset D$};

\node at (5,-1) {$\rangle$};
\node at (6,-1) {$\rangle$};
\node at (7,-1) {$\rangle$};
\node at (8,-1) {$\rangle$};
\node at (9,-1) {$\rangle$};

\node at (-4.25,5.5) {$V$};
\node at (4.25,5.5) {$W$};

\node at (-5,4.5) {$\ga$};
\node at (-3.5,4.5) {$\gb$};
\node at (3.5,4.5) {$\gg$};
\node at (5,4.5) {$\gd$};
\end{tikzpicture}
\caption{Four crossing-free alignments.\label{figCFPMklqp}}
\end{figure}
Call $\pointset S$ the set of $a-b$ points of $\pointset A$ that are matched with points of
$\pointset D$, and call $\pointset T$ the set of $d-c$ points of $\pointset D$ that are matched to points of
$\pointset A$.

The matching is uniquely determined by $\ga$, $\gb$, the choice of
the subsets $\pointset S\Subset\pointset A$ and $\pointset T \Subset D$,
and by $\gb$ and $\gc$. This gives the following bound for the number of these matchings:\[
\gn_{\pointset P}\of{\langle^a\rangle^b\langle^c\rangle^d}
\leq \CatalanNumber a \binom a b \CatalanNumber b \CatalanNumber c \binom c d \CatalanNumber d\text.\]
Asymptotically, the factor involving $a$ and $b$ is, for $b=\gh a$,\[
\CatalanNumber a \binom a b \CatalanNumber b
\preccurlyeq_{a+b}
4^{a+b} \binom a b
\preccurlyeq_{a+b}
4^{a+b}
\pa{
\underbrace{
\pa{\frac
  {\pa{1-\gh}^{1-\frac 1 \gh}}
  {\gh}}^{\pa{\frac{\gh}{\gh+1}}}}_{x_\gh}}^{a+b}\text,
\]
uniformly in $\gh\in\intclos 01$. The base $x_\gh$ of the exponential bound
for the binomial coefficient is maximal
when $\gh = \frac{3-\sqrt{5}}{2}$, where it is $\GoldenRatio = \frac{1+\sqrt{5}}{2}$.
This gives the overall bound\[
\gn_{\pointset P}\of{\langle^a\rangle^b\langle^c\rangle^d}
\preccurlyeq_{\Cardinality{\pointset P} = n}
4^{a+b}
\GoldenRatio^{a+b}
4^{c+d}
\GoldenRatio^{c+d}
= \pa{4\GoldenRatio}^n
\approx 6.472^n
\]
uniformly in $a$, $b$, $c$, and $d$ such that $a+b+c+d=n$.
Note that this is worse than the existing $5.3793^n$ bound $\gn_{\pointset P}\of{B}$ for an arbitrary
well-formed bracket expression $B$, see section~\ref{boundOnLeftRightPerfectMatchings}.
\subsection{Improving the binomial bound}
We can however improve upon that bound. Once $\ga$, $\gd$, $\pointset S$, and $\pointset T$
are fixed, the edges of the matching that cross both the left line
and the right line---let us call these \emph{long edges}---are determined.
As a result,
the strip $\gS$ between the vertical lines $V$ and $W$ is partitioned by the long edges in trapezoidal cells
$Z_1,\dotsc,Z_{a-b+1}$, numbered from top to bottom, where the first and last cells are
unbounded, see figure~\ref{figTrapezoids}.
\marginfig[The points of $\pointset S\Subset \pointset A$ and
$\pointset T\Subset \pointset D$ are shown in white.
The vertical lines $V$ and $W$ bound the strip $\gS$.
The long edges join $\pointset S$ and
$\pointset T$, partitioning the strip $\gS$ in cells $Z_i$.
The crossing-free right-alignments $\gb_i$ are shown.
Note that here $\pointset B_4$ is empty.
In this figure, $a=7$, $b=4$, $c=1$, and $d=4$.
\label{figTrapezoids}]{
\begin{tikzpicture}[scale=0.6]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\tikzstyle{wdot}=[draw,shape=circle,fill=white,scale=0.5]

\draw[very thick, name path=V] (0,5) -- (0,-2);
\draw[very thick, name path=W] (4,5) -- (4,-2);


\node at (-1,5) {$\pointset A$};
\node at (5,5) {$\pointset D$};

\node at (0,5.5) {$V$};
\node at (4,5.5) {$W$};

\node at (2,-2) {$\gS$};

\node at (3,4.5) {$Z_1$};
\node at (3,2.5) {$Z_2$};
\node at (2.5,0.25) {$Z_3$};
\node at (1.5,-1) {$Z_4$};

\node[dot] at (-.5,4) (a1) {};
\node[wdot] at (-2,3.5) (a2) {};
\node[dot] at (-1.4,2.5) (a3) {};
\node[dot] at (-1.5,2) (a4) {};
\node[wdot] at (-1,1) (a5) {};
\node[dot] at (-1.3,0.5) (a6) {};
\node[wdot] at (-2.2,0) (a7) {};

\node[dot] at (2,4.2) (b1) {};
\node[dot] at (1.8,2.6) (b3) {};
\node[dot] at (2.2,1.8) (b4) {};
\node[dot] at (1.9,0.6) (b6) {};

\node[dot] at (3,0.3) (c) {};

\node[wdot] at (4.5,3.8) (d2) {};
\node[wdot] at (5,0.9) (d5) {};
\node[wdot] at (4.25,-.8) (d7) {};
\node[dot] at (5.25,0) (dc) {};

\draw (a2) -- (d2);
\draw (a5) -- (d5);
\draw (a7) -- (d7);

\draw[gray] (c) -- (dc);

\draw[gray, name path=edge] (a1) -- (b1);
\draw[->,thick,name intersections={of=edge and V, by=align}] (b1) -- (align);
\node[label={[font=\scriptsize,label distance=-3pt]above right:$1$}] at (align) {};
\draw[gray, name path=edge] (a3) -- (b3);
\draw[->,thick,name intersections={of=edge and V, by=align}] (b3) -- (align);
\node[label={[font=\scriptsize,label distance=-3pt]above right:$1$}] at (align) {};
\draw[gray, name path=edge] (a4) -- (b4);
\draw[->,thick,name intersections={of=edge and V, by=align}] (b4) -- (align);
\node[label={[font=\scriptsize,label distance=-3pt]below right:$2$}] at (align) {};
\draw[gray, name path=edge] (a6) -- (b6);
\draw[->,thick,name intersections={of=edge and V, by=align}] (b6) -- (align);
\node[label={[font=\scriptsize,label distance=-3pt]below right:$1$}] at (align) {};
\end{tikzpicture}}

We will consider the crossing-free right-alignment $\gb$; the same argument will hold for $\gg$.
Since $\pointset B$ lies within the strip $\gS$, it is partitioned in $a-b+1$ subsets
$\pointset B_i\DefineAs\pointset B \Intersection Z_i$.
Moreover, an edge $e_p$ emanating from a point $p\in\pointset B_i$ cannot cross the long edges,
and thus the portion $e_p\Intersection \gS$ of $e_p$ that lies within the strip $\gS$ is confined to the cell $Z_i$.

Let $\gb_i$ be the crossing-free right-alignment of $\pointset B_i$ on $V$ realized by
the segments $\setst{e_p\Intersection \gS}{p\in\pointset B_i}$.
Since the set of segments $\setst{e_p\Intersection \gS}{p\in\pointset B}$ realizes $\gb$,
$\gb$ is composed of the crossing-free right-alignments $\gb_i$. Formally, for
$p\in\pointset B_i$,
\[\gb\of p = \gb_i\of p + \sum{j=1}[i-1] \Cardinality{\pointset B_i}\text.\]
We now know that $\gb$ is determined by crossing-free alignments $\gb_i$ of point sets $\pointset B_i$.
In order to turn this into a bound, we need to know the sizes $\Cardinality{\pointset B_i}$ of these
point sets.
\marginfig[The edges crossing $V$. The points of $\pointset S$ are shown in white. The
crossing-free left-alignment $\ga$ of $\pointset A$ on $V$ is shown.
The elements of $S=\ga\of{\pointset S}$ are shown in red.
We have $\cells\of{[a]\setminus S}=\set{\set{1},\set{3,4},\set{6}}$.
Since $\pointset B_4$ is empty, there is no cell of ${[a]\setminus S}$
corresponding to it.\label{figCellsOnALine}]{
\begin{tikzpicture}[scale=0.6]
\tikzstyle{dot}=[draw,shape=circle,fill=black,scale=0.5]
\tikzstyle{wdot}=[draw,shape=circle,fill=white,scale=0.5]

\draw[very thick, name path=V] (0,5) -- (0,-2);
\path[name path=W] (3,5) -- (3,-2);

\node at (-2,5) {$\pointset A$};

\node at (0,5.5) {$V$};

\node at (3,4.5) {$\pointset B_1$};
\node at (3,2.5) {$\pointset B_2$};
\node at (3,0.25) {$\pointset B_3$};
\node at (3,-2) {$\pointset B_4 = \EmptySet$};

\node[dot] at (-.5,4.5) (a1) {};
\node[wdot] at (-2,3.5) (a2) {};
\node[dot] at (-1.4,2.5) (a3) {};
\node[dot] at (-1.5,2) (a4) {};
\node[wdot] at (-1,1) (a5) {};
\node[dot] at (-1.3,0) (a6) {};
\node[wdot] at (-2.2,-0.7) (a7) {};

\node[dot] at (2,4.7) (b1) {};
\node[dot] at (1.8,2.6) (b3) {};
\node[dot] at (2.2,1.8) (b4) {};
\node[dot] at (1.9,0.1) (b6) {};

\node at (4,3.8) (d2) {};
\node at (4,0.9) (d5) {};
\node at (4,-1.3) (d7) {};

\path[name path=long edge] (a2) -- (d2);
\draw[dashed,name intersections={of=long edge and W, by=far}] (d2) -- (far);
\draw (a2) -- (far);
\draw[->,thick,name intersections={of=long edge and V, by=align}] (a2) -- (align);
\node[label={[font=\scriptsize,label distance=-5pt]above left:$\color{red}2$}] at (align) {};

\path[name path=long edge] (a5) -- (d5);
\draw[dashed,name intersections={of=long edge and W, by=far}] (d5) -- (far);
\draw (a5) -- (far);
\draw[->,thick,name intersections={of=long edge and V, by=align}] (a5) -- (align);
\node[label={[font=\scriptsize,label distance=-5pt]below left:$\color{red}5$}] at (align) {};

\path[name path=long edge] (a7) -- (d7);
\draw[dashed,name intersections={of=long edge and W, by=far}] (d7) -- (far);
\draw (a7) -- (far);
\draw[->,thick,name intersections={of=long edge and V, by=align}] (a7) -- (align);
\node[label={[font=\scriptsize,label distance=-5pt]below left:$\color{red}7$}] at (align) {};

\draw[gray, name path=edge] (a1) -- (b1);
\draw[->,thick,name intersections={of=edge and V, by=align}] (a1) -- (align);
\node[label={[font=\scriptsize,label distance=-5pt]above left:$1$}] at (align) {};
\draw[gray, name path=edge] (a3) -- (b3);
\draw[->,thick,name intersections={of=edge and V, by=align}] (a3) -- (align);
\node[label={[font=\scriptsize,label distance=-5pt]above left:$3$}] at (align) {};
\draw[gray, name path=edge] (a4) -- (b4);
\draw[->,thick,name intersections={of=edge and V, by=align}] (a4) -- (align);
\node[label={[font=\scriptsize,label distance=-5pt]below left:$4$}] at (align) {};
\draw[gray, name path=edge] (a6) -- (b6);
\draw[->,thick,name intersections={of=edge and V, by=align}] (a6) -- (align);
\node[label={[font=\scriptsize,label distance=-5pt]below left:$6$}] at (align) {};
\end{tikzpicture}}

Let us look at the edges crossing $V$, numbered from top to bottom from $1$ to $a$, see
figure~\ref{figCellsOnALine}. Of these $a$ edges,
$a-b$ are long edges; they are the edges emanating from $\pointset S$. 
Their numbers are $S = \ga\of{\pointset S} \Subset [a]$.
The other edges are the ones that emanate from points of $\pointset B$.
Let $s_i$ be the $i$th element of $S$ in increasing order, thus $s_1=\min S$, and
$s_{\Cardinality S} = s_{a-b} = \max S$.

The numbering of the $a$ edges crossing $V$, from top to bottom, then starts with
the edges emanating from $\pointset B_1$, numbered $1$ through
$s_1-1$, the first long edge, numbered $s_1$, the edges emanating from
$\pointset B_2$, numbered $s_1+1$ through $s_2-1$, the second long edge,
numbered $s_2$, the edges emanating from $\pointset B_3$, numbered from $s_2+1$, \etc.
In other words, the numbers of the edges emanating from any nonempty $\pointset B_i$ forms
a maximal set of consecutive elements of $[a]\setminus S$. This motivates the following
definition.

\begin{definition}[cells of a set of integers]
The \emph{cells} of $S'\Subset \N$, written $\cells\of{S'}$, is the set of maximal subsets of
consecutive elements $S'$.
\end{definition}
For instance, $\cells\of{\set{2,3,5,6,7,10,13,14}}=\set{\set{2,3},\set{5,6,7},\set{10},\set{13,14}}$.

Then, we can improve the $\binom a b \CatalanNumber b$ factor in the bound (in which the binomial comes from
the choice of $\pointset S$, and the Catalan number comes
from the choice of $\gb$), summing over the choices of $\pointset S$ (and thus of $S$ above).
The improved factor becomes\footnote{The name $\spc$ was chosen because we define this as
a Sum of Products of Catalan numbers.}\begin{equation}
\spc\of{a,b}\DefineAs
\sum{S\in\binom{[a]}{a-b}} \quad \prod{\gc\in\cells\of{[a] \setminus S}}\CatalanNumber {\Cardinality \gc} =
\sum{S'\in\binom{[a]}{b}} \quad \prod{\gc\in\cells\of{S'}}\CatalanNumber {\Cardinality \gc}\text,
\label{spcDefinition}
\end{equation}
and the overall bound becomes\begin{equation}
\gn_{\pointset P}\of{\langle^a\rangle^b\langle^c\rangle^d}\leq
\CatalanNumber a\spc\of{a, b}\spc\of{c, d}\CatalanNumber d\text.\label{bound-ck-spckl-spcpq-cp}
\end{equation}

\subsection{A recurrence}
In order to compute $\spc$ efficiently, and eventually, get its asymptotics, it is useful to get rid
of the $\cells$ function. We can express $\spc$ as a recurrence instead.
First, we note that $\spc\of{a,a} = \CatalanNumber k$: there is only one summand, $S'$ is the whole set, so
it has only one cell, namely $S'$ itself.
Otherwise, $a-b\geq 1$; in the sum over the $S$, consider the greatest element $j$ of $S$, which is at least
$a-b$, and split the sum over that,
\[\spc\of{a,b} = \sum{j=a-b}[a]\quad\;
\sum{\substack{S\in\binom{[a]}{a-b} \\ j=\max S}} \quad
\prod{\gc\in\cells\of{[a] \setminus S}}\CatalanNumber {\Cardinality \gc}\text.
\]
For fixed $j$, all summands (of the sum over $S$) will have a factor
with $\gc=\set{j+1,\dotsc,a}$, and thus a factor of
$\CatalanNumber {a-j}$. Factoring out this $\CatalanNumber {a-j}$, we get
\[\spc\of{a, b} = \sum{j=a-b}[a]
\CatalanNumber {a-j} \;\;
\sum{\substack{S\in\binom{[a]}{a-b} \\ j=\max S}} \quad
\prod{\substack{\gc\in\cells\of{[a] \setminus S} \\ \gc\neq\set{j+1,\dotsc,a}}}
    \CatalanNumber {\Cardinality \gc}\text.
\]
Now, note that choosing a subset $S$ of $[a]$ of size $a-b$ whose maximum is $j$ is equivalent to choosing
a subset $\tilde{S}$ of $[j-1]$ of size $a-b - 1$, where $S=\tilde{S}\Union\set{j}$.
Moreover, the cells of $[a]\setminus S$ other
than $\set{j+1,\dotsc,a}$ are exactly the cells of $[j-1]\setminus \tilde{S}$, thus
\[\spc\of{a,b} = \sum{j=a-b}[a]
\CatalanNumber {a-j} \;\;
\sum{\tilde{S}\in\binom{[j-1]}{a-b - 1}} \quad\;
\prod{\gc\in\cells\of{[j-1]\setminus \tilde{S}}}
    \CatalanNumber {\Cardinality \gc}\text.
\]
By definition of $\spc$, this means
\[\spc\of{a,b} = \sum{j=a-b}[a]
\CatalanNumber {a-j}
\spc\of{j-1,b+j-a}\text.
\]
Rewriting this as a sum over $i\DefineAs a-j$, this gives us the following recurrence for $\spc$:
\begin{align}\spc\of{a,b} &= \sum{i=0}[l]
\CatalanNumber {i}
\spc\of{a-i-1,b-i} &\text{for $b<a$,} \label{spcRecurrence1}\\
\spc\of{a,a} &= \CatalanNumber a \label{spckk}\text.
\end{align}\marginfig[The first few values of $\spc$; $a$ vertically from $0$ to $5$,
$b$ horizontally from $0$ to $a$. The values appearing in the $b+1$ summands of the
recurrence (\ref{spcRecurrence1}) with $a = 6$ and $b = 3$ are highlighted.]{
$\begin{array}{r r r r r r}
1 \\
{\color{red}1} & 1 \\
1 & {\color{red}2} &  2 \\
1 & 3 &  {\color{red}5} & 5 \\
1 & 4 &  9 & \tn{lastSummand}{\color{red}$14$} & 14 \\
1 & 5 & 14 & \tn{result}{$28$} & 42 & 42
\end{array}$
\tikz[remember picture,overlay]
    \path[->] (lastSummand.south) edge (result.north -| lastSummand.south);
}
\subsection{A better recurrence}
We can now turn this recurrence into a simpler and better-known one, namely
\begin{align}
\spc\of{a,b} &= \spc\of{a-1, b} + \spc\of{a,b-1} & \text{for $a\geq 1$, $0\leq b \leq a$,}\label{spc-catalan-triangle}\\
\spc\of{a,b} &= 0 & \text{for $b < 0$ or $b > a$,}\label{degeneratespc}\\
\spc\of{0,0} &= 1 \label{spc00}\text.
\end{align}
Since $\spc$ has not been formally defined for negative arguments, we extend the definition
with $\spc\of{a,b}=0$ for $b<0$; this is consistent with original the definition, since it yields a sum over
subsets $S\Subset [a]$ bigger than $a$, and it yields an empty sum in the recurrence we just derived.
In addition to that, we also let $\spc\of{a,b} = 0$ when $b > a$. This takes care of (\ref{degeneratespc}).
Moreover, we know that $\spc\of{0,0}=\CatalanNumber 0=1$. There thus remains to prove (\ref{spc-catalan-triangle}).
We will do so first for $b=a$, then for $b=a-1$, and finally for the $0\leq b < a-1$.

Note that we have\begin{align}
\spc\of{b, b-1}
= \sum{i=0}[b-1]\CatalanNumber {i}\spc\of{b-i-1,b-i-1} 
= \sum{i=0}[b-1]\CatalanNumber {i}\CatalanNumber {b-i-1}
= \CatalanNumber {b}\text,\label{spckkminusone}
\end{align}
and thus, for $a=b > 0$,
\begin{equation}
\spc\of{a,b} = \CatalanNumber b = 0 + \CatalanNumber b = \spc\of{a-1, b} + \spc\of{a, b-1}.
\end{equation}
Further, for $a - 1 = b$, we get
\begin{align}
\spc\of{a,b}
&= \sum{i=0}[b]\CatalanNumber {i}\CatalanNumber {b-i} =
\CatalanNumber b + \sum{i=0}[b-1]\CatalanNumber{i}\CatalanNumber {b-i} \nonumber\\
\intertext{applying (\ref{spckk}) on the left and (\ref{spckkminusone}) on the right,}
&= \spc\of{a-1, b} + \sum{i=0}[b-1]\CatalanNumber {i}\spc\of{b-i,b-i-1} \nonumber\\
&= \spc\of{a-1, b} + \sum{i=0}[b-1]\CatalanNumber {i}\spc\of{a-i-1,b-i-1} \nonumber\\
&= \spc\of{a-1, b} + \spc\of{a,b-1}\text.
\end{align}

Now let $a - 1 > b \geq 0$.
Assume $\spc\of{a',b'}=\spc\of{a'-1,b'}+\spc\of{a',b'-1}$ for $0\leq b'<a'<a$.
Then we can apply this assumption to the summands of $\spc\of{a,b}$:
\begin{align}
\spc\of{a,b} &= \sum{i=0}[b]
\CatalanNumber {i}
\spc\of{a-i-1,b-i} \nonumber \\
&= \sum{i=0}[b]
\CatalanNumber {i}
\pa{\spc\of{a-i-2,b-i}+\spc\of{a-i-1,b-i-1}} \nonumber \\
&= \sum{i=0}[b]
\CatalanNumber {i}\spc\of{a-i-2,b-i}
+\sum{i=0}[b]\CatalanNumber {i}\spc\of{a-i-1,b-i-1} \nonumber \\
&= \sum{i=0}[b]
\CatalanNumber {i}\spc\of{(a-1)-i-1,b-i}
+\sum{i=0}[b-1]\CatalanNumber {i}\spc\of{a-i-1,(b-1)-i} \nonumber \\&\phantom{=}\qquad +
\underbrace{\CatalanNumber {b}\spc\of{a-b-1,-1}}_{=0}\text,
\nonumber \\
\intertext{so, by (\ref{spcRecurrence1}),}
&= \spc\of{a-1, b} + \spc\of{a,b-1}\text.
\end{align}
This completes the proof of (\ref{spc-catalan-triangle}).
\marginfig[The recurrence (\ref{spc-catalan-triangle}).]{
$\begin{array}{r r r r r r}
1 \\
1 & 1 \\
1 & 2 &  2 \\
1 & 3 &  5 & 5 \\
1 & 4 &  9 & \tn{summandAbove}{$14$} & 14 \\
1 & 5 & \tn{summandLeft}{$14$} & \tn{result}{$28$} & 42 & 42
\end{array}$
\tikz[remember picture,overlay]
    \path[->] (summandAbove.south) edge (result.north -| summandAbove.south)
              (summandLeft) edge (result);
}

The recurrence we just proved is the one defining the Catalan
triangle\footnote{[TODO cite something that actually uses that
name here]}, and its solution is known, namely
\begin{equation}
\spc\of{a,b} = \frac
{\Factorial{\pa{a+b}} \pa{a-b+1}}
{\Factorial b \Factorial{\pa{a+1}}}
= \frac{a-b+1}{a+1} \binom{a+b}{a}\label{spc-solution}
\text,
\end{equation}
as shown by L.~F.~A.~Arbogast in 1800 \cite[p.~214--217]{Arbogast1800}.
\subsubsection{A combinatorial interpretation of \texorpdfstring{$\spc$}{spc}}
The Catalan triangle counts well-formed prefixes [CITATION];
specifically, $\spc\of{a,b}$ is the number of well-formed prefixes with $a$ opening brackets
and $b$ closing brackets. This can in fact be seen from
all the definitions of $\spc$ above, thus providing a more combinatorial solution, as we will now see.

In the original definition (\ref{spcDefinition}) of $\spc$, the sum is over the choices for the positions of the
$a-b$ unmatched opening brackets; between those, well-formed bracket expressions (counted by Catalan numbers) are
inserted.

The first recurrence (\ref{spcRecurrence1}) corresponds to the following grammatical
definition\footnote{This grammar requires infinite look-ahead to parse, but doing a first pass to mark the
unmatched opening brackets resolves that.} of well-formed
prefixes, where again wfbe denotes a well-formed bracket expression:
\begin{align*}
\text{wfprefix} \Coloneq
& \text{wfbe} \langle \text{wfprefix} \\
\mid\: & \text{wfbe}.
\end{align*}
In this case the sum ranges over the length of the well-formed bracket expression preceding the first unmatched bracket.

Finally, (\ref{spc-catalan-triangle}) reflects the fact that a well-formed prefix with $k$ opening brackets
and $l$ closing brackets either ends with an opening bracket (preceded by a well-formed prefix with $k-1$ opening
and $l$ closing brackets), or with a closing bracket (preceded by a well-formed prefix with $k$ opening
and $l-1$ closing brackets).
\subsubsection{Tying some loose ends}
TODO here give a combinatorial proof for the $\gcp$ from the section on highly convex matchings.
\subsection{Asymptotics}
We can now use the expression (\ref{spc-solution}) for $\spc$ to study the asymptotics of the bound
(\ref{bound-ck-spckl-spcpq-cp}).
We are interested in the asymptotics as a function of the length $n = a+b+c+d$ of the bracket expression.
Since the bound is a product of two identical two-parameter factors, we study one of them,\[
f_{a,b}\DefineAs \CatalanNumber a\spc\of{a,b}\text,
\]
as a function of $k\DefineAs a+b$. Let $b = \gh a$, thus $0\leq \gh\leq 1$,
the above expression becomes \[
f_{\frac{k}{\gh+1}, \frac{k\gh}{\gh+1}}=
\CatalanNumber {\frac{k}{\gh + 1}} \binom{k}{\frac{k}{\gh + 1}} \frac{k-k\gh+\gh+1}{k+\gh+1}
\leq \CatalanNumber {\frac{k}{\gh + 1}} \binom{k}{\frac{k}{\gh + 1}}\text.
\]
Asymptotically, this yields\[
f_{\frac{k}{\gh+1}, \frac{k\gh}{\gh+1}}\preccurlyeq_k
4^{\frac{k}{\gh + 1}}
\pa{
  \frac
    {\pa{1-\frac{1}{\gh+1}}^{\frac{1}{\gh+1}-1}}
    {\pa{\frac{1}{\gh+1}}^{\frac{1}{\gh+1}}}}^{k}
= \pa{\underbrace{4^{\frac{1}{\gh + 1}} \frac{\gh+1}{\gh^{\frac{\gh}{\gh+1}}}}_{y_\gh}}^k
\]
uniformly in $\gh\in\intclos 0 1$.
With some calculus, one can see that as $\gh$ ranges from $0$ to $1$,
the base $y_\gh$ of that exponential is maximal for
$\gh=\frac 1 4$, where its value is $5$.
We thus have the following asymptotic bound:\begin{equation}
\gn_{\pointset P}\of{\langle^a\rangle^b\langle^c\rangle^d}\leq
\CatalanNumber a\spc\of{a, b}\spc\of{c, d}\CatalanNumber d
\preccurlyeq_{\Cardinality{\pointset P} = n}
5^{a+b}5^{c+d} = 5^n
\end{equation}
uniformly in $a$, $b$, $c$, and $d$ such that $a+b+c+d=n$.
\section{Outlook}
[TODO: here a section about spc generalizing to arbitrary WFBEs, and the applicability of overcounting
analyses]
\clearpage
\nocite{*}
\bibliography{crossing-free-perfect-matchings}
\bibliographystyle{plain}

\end{document}
